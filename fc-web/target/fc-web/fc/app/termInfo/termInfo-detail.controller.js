(function(){angular.module("devplatformApp").controller("TermInfoDetailController",a);a.$inject=["FcPublicService","TermInfoService","$scope","$stateParams","$state","ngDialog","PublicService","$uibModalInstance","$translate","SysDictService","BankRuleService"];function a(r,g,p,o,c,m,i,n,d,l,h){p.replenishRule=[{value:d.instant("bankRule.Monday"),key:1},{value:d.instant("bankRule.Tuesday"),key:2},{value:d.instant("bankRule.Wednesday"),key:3},{value:d.instant("bankRule.Thursday"),key:4},{value:d.instant("bankRule.Friday"),key:5},{value:d.instant("bankRule.Saturday"),key:6},{value:d.instant("bankRule.Sunday"),key:7}];p.workday=p.replenishRule.slice(0,5);p.formParam={};p.init=function(){f("termTypeList","forecast.termType");f("regionList","forecast.region");f("branchList","forecast.branch");f("commercialList","forecast.commercial");f("termStatusList","forecast.termStatus");f("termTypeList","forecast.termType");f("forecastStatusList","forecast.forecastStatus");f("escortList","forecast.escort");k();q();e();p.changeCurrency("HKD","0");p.add();p.changeCurrency("CNY","1")};function q(){p.showCheckBox=true;r.getBanksList().then(function(s){if(s.statusCode==="0000"){p.bankList=s.data}})}function k(){r.getCusgionList().then(function(s){if(s.statusCode==="0000"){p.cusgionList=s.data}})}function f(t,s){l.getDictListAsync(s).then(function(u){if(u.statusCode==="0000"){p[t]=u.data}})}function e(){if(o.id){g.getTermInfo(o.id).then(function(s){if(s.statusCode==="0000"){p.formParam=s.data;b()}})}}function b(){if(p.formParam.termCashLimits.length==0){p.formParam.termCashLimits=[{type:"",denominationList:[]}]}var w=[];angular.forEach(p.replenishRule,function(x){if(p.formParam.replenishRule){if(p.formParam.replenishRule.indexOf(x.key+"")>=0){w.push(x)}}});var v=i.showData(p.formParam.replenishRule,p.replenishRule);p.select_all=v.selectAll;p.select_workDay=v.selectWorkDay;if(w.length>0){p.flagChecked(w,true)}j(p.formParam.lackWarn,"lackWarn");j(p.formParam.fullWarn,"fullWarn");var u=p.formParam.termCashLimits;for(var t=0;t<u.length;t++){if(p.formParam.termCashLimits[t]["denominationList"].length==0){p.changeCurrency("HKD","0");p.add();p.changeCurrency("CNY","1")}if(p.formParam.termCashLimits[t]["denominationList"].length==1){p.formParam.termCashLimits[t]["denominationList"][0]["dictDescs"]="￥:"+p.formParam.termCashLimits[t]["denominationList"][0]["denomination"]}else{for(var s=0;s<p.formParam.termCashLimits[t]["denominationList"].length;s++){p.formParam.termCashLimits[t]["denominationList"][s]["dictDescs"]="HK$:"+p.formParam.termCashLimits[t]["denominationList"][s]["denomination"]}}}}p.add=function(){p.formParam.termCashLimits.splice(p.formParam.termCashLimits.length+1,0,{denominationList:[],type:""})};p.changeCurrency=function(u,s){var t="forecast.denomination."+u;l.getDictListAsync(t).then(function(v){if(v.statusCode==="0000"){console.log(v);angular.forEach(v.data,function(x){x.denomination=x.dictDesc;x.count=0});p.formParam.termCashLimits[s]["denominationList"]=v.data;if(p.formParam.termCashLimits[s]["denominationList"].length==1){p.formParam.termCashLimits[s]["type"]="CNY";p.formParam.termCashLimits[s]["denominationList"][0]["dictDescs"]="￥:"+p.formParam.termCashLimits[s]["denominationList"][0]["dictDesc"]}else{p.formParam.termCashLimits[s]["type"]="HKD";for(var w=0;w<p.formParam.termCashLimits[s]["denominationList"].length;w++){p.formParam.termCashLimits[s]["denominationList"][w]["dictDescs"]="HK$:"+p.formParam.termCashLimits[s]["denominationList"][w]["dictDesc"]}}}})};function j(t,s){if(t){angular.forEach(p.formParam.termCashLimits,function(u){angular.forEach(u.denominationList,function(v){if(v.minCeilingCount>v.ceilingCount){v.minCeilingCount=v.ceilingCount}v[s]=parseInt(v.ceilingCount*parseFloat(t/100,10))})})}}p.flagChecked=function(s,t){angular.forEach(s,function(u){u.checked=t})};p.clear=function(s){n.close();c.go("app.termInfo",{},{reload:s})}}})();