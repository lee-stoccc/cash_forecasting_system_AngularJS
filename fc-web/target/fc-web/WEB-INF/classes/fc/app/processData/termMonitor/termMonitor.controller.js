(function(){angular.module("devplatformApp").controller("TermMonitorController",a);a.$inject=["FcPublicService","TermInfoService","TermMonitorService","ngDialog","$state","$scope","PublicService","SysDictService","globalConstant","$stateParams","Upload","$translate"];function a(b,r,s,i,p,k,h,o,c,q,n,l){k.datePickerOpenStatus={};var g=new Date();var j=new Date(g.getTime()-24*60*60*1000);var g="";var j="";k.formParam={startTime:j,endTime:g};k.choseArr=[];k.init=function(){m("deTypeList","forecast.denomination");f();d();e();k.tablesConfig={showCheckBox:true,isColspan:true,checkOneAction:"checkOneAction",checkAllAction:"checkAllAction",rowSpan:3,tableTitles:[{title:"termInfo.bankName",filed:"bankName",type:"text",width:20,tipTitle:"Branch Name"},{title:"termInfo.branchNo",filed:"branchName",type:"text",width:10,tipTitle:"Branch Name"},{title:"termInfo.termNo",filed:"termNo",type:"text",width:10,tipTitle:"Branch Name"},{title:"termInfo.termType",filed:" typeName",type:"text",width:8,tipTitle:"Branch Name"},{title:"termMonitor.amount",dynamicTitles:k.colSpanData,filed:"monitorDetails",chridTitle:"dictDesc",chridFiled:"count",type:"text",width:20},{title:"termInfo.status",filed:"status",type:"text",width:8,tipTitle:"Terminal Type"},{title:"termInfo.date",filed:"monitorTime",type:"dateTime",format:"yyyy-MM-dd HH:mm",width:10,tipTitle:"Date"},],url:"api/termMonitor/page",formParams:{termNo:k.formParam.termNo,cusTermNo:k.formParam.cusTermNo,bankId:k.formParam.bankId,startTime:j,endTime:g}};k.select("#bankNameMonitor");k.select("#cusRegionMonitor")};k.select=function(t){angular.element(t).select2({placeholder:l.instant("global.pleaseSelect"),allowClear:true,tags:false})};k.checkOneAction=function(t){k.choseArr=[];angular.forEach(t,function(u){if(u.checked){k.choseArr.push(u)}})};k.checkAllAction=function(t){k.choseArr=[];angular.forEach(t,function(u){if(u.checked){k.choseArr.push(u)}})};k.colSpanData=[];function e(){for(var t=0;t<k.deTypeList.length;t++){var u=k.deTypeList[t].dictKey;var v="forecast.denomination."+u;o.getDictListAsync(v).then(function(w){if(w.statusCode==="0000"){var x={itemList:[],type:""};x.itemList=w.data;switch(u){case"HKD":x.title=u+"(HK$)";break;case"CNY":x.title=u+"(ï¿¥)";break}k.colSpanData[t]=x}})}}function d(){b.getCusgionList().then(function(t){if(t.statusCode==="0000"){k.cusgionList=t.data}})}function m(u,t){o.getDictListAsync(t).then(function(v){if(v.statusCode==="0000"){k[u]=v.data}})}k.bankTermMonitorSelectCheck=function(t){};k.bankTermMonitorSelectItem=function(t){};function f(){b.getBanksList().then(function(t){if(t.statusCode==="0000"){k.bankList=t.data}})}k.loadAll=function(){var v=k.formParam.startTime;var u=k.formParam.endTime;var t=h.subTime(v,u);k.refreshTableList(k.formParam)};k.resetSearch=function(){k.formParam={};f();d();k.bankNoStr="";k.bankName=""};k.openCalendar=function(t){k.datePickerOpenStatus[t]=true};k.importExcel=function(t){var u=c.devplatform_web_apiPath+"api/termMonitor/importExcel";h.submitFile(t,u,"loadAll",k)};k.upLoadTempFile=function(u){var t=c.devplatform_web_apiPath+"api/termMonitor/uploadTemplate";h.submitFile(u,t)};k.downLoadFile=function(){s.downLoadFile()};k.batchDelete=function(){var t="";if(k.choseArr.length===0){t="global.selectDelete";h.openDialog(t);return}t="global.messages.deleteConfirm";h.showConfirmDialog(t,"confirmDelete",k)};k.confirmDelete=function(){var t="";angular.forEach(k.choseArr,function(v,u){t+=v.id;if(u!=k.choseArr.length-1){t+=","}});s.deleteTermMonitor(t).then(function(u){if(u.statusCode==="0000"){k.loadAll();k.choseArr=[];var v="global.messages.deleteSuccess";h.openDialog(v)}})};k.$watch("formParam",function(w,v){if(w.endTime!=""||w.startTime!=""){var t=h.compareTime(w.startTime,k.formParam.endTime);if(!t){var u="global.timeMsg1";h.openDialog(u)}}},true)}})();