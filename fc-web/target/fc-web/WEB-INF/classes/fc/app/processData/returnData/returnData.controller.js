(function(){angular.module("devplatformApp").controller("ReturnDataController",a);a.$inject=["FcPublicService","ReturnDataService","ngDialog","$state","$scope","PublicService","SysDictService","globalConstant","$stateParams","Upload","$translate"];function a(c,f,k,r,m,j,q,d,s,p,n){m.datePickerOpenStatus={};m.format="";m.formParam={};var b=new Date();m.formParam.date=new Date();var i=new Date(b.getTime());var l=new Date(b.getTime()-24*60*60*1000*6);m.formParam={date:l,dateTo:i};m.choseArr=[];m.init=function(){o("deTypeList","forecast.denomination");h();e();g();m.tablesConfig={showCheckBox:true,isColspan:true,rowSpan:3,checkOneAction:"checkOneAction",checkAllAction:"checkAllAction",tableTitles:[{title:"termInfo.bankName",filed:"bankName",type:"text",width:25,tipTitle:"Branch Name"},{title:"termInfo.termNo",filed:"termNo",type:"text",width:10,tipTitle:"Terminal ID"},{title:"termInfo.termType",filed:" typeName",type:"text",width:10,tipTitle:"Terminal Type"},{title:"castData.return",dynamicTitles:m.colSpanData,filed:"details",chridTitle:"dictDesc",chridFiled:"count",type:"text",width:10},{title:"castData.returnTime",filed:"dateTime",type:"dateTime",format:"yyyy-MM-dd HH:mm",width:10,tipTitle:"Date"},],url:"api/returnData/page",formParams:{termNo:m.formParam.termNo,date:m.formParam.date,dataTo:m.formParam.dateTo,bankId:m.formParam.bankId,}};m.select("#bankNameReturnData");setTimeout(function(){m.refreshTableList(m.formParam)},200)};m.select=function(t){angular.element(t).select2({placeholder:n.instant("global.pleaseSelect"),allowClear:true,tags:false})};m.checkOneAction=function(t){m.choseArr=[];angular.forEach(t,function(u){if(u.checked){m.choseArr.push(u)}})};m.checkAllAction=function(t){m.choseArr=[];angular.forEach(t,function(u){if(u.checked){m.choseArr.push(u)}})};function e(){c.getCusgionList().then(function(t){if(t.statusCode==="0000"){m.cusgionList=t.data}})}m.colSpanData=[];function g(){for(var t=0;t<m.deTypeList.length;t++){var u=m.deTypeList[t].dictKey;var v="forecast.denomination."+u;q.getDictListAsync(v).then(function(w){if(w.statusCode==="0000"){var x={itemList:[],type:""};x.itemList=w.data;switch(u){case"HKD":x.title=u+"(HK$)";break;case"CNY":x.title=u+"(ï¿¥)";break}m.colSpanData[t]=x}})}}function o(u,t){q.getDictListAsync(t).then(function(v){if(v.statusCode==="0000"){m[u]=v.data}})}m.bankReturnDataSelectCheck=function(t){};m.bankReturnDataSelectItem=function(t){};function h(){m.showCheckBox=true;c.getBanksList().then(function(t){if(t.statusCode==="0000"){m.bankList=t.data}})}m.loadAll=function(){m.refreshTableList(m.formParam)};m.resetSearch=function(){h();m.formParam={};m.loadAll()};m.openCalendar=function(t){m.datePickerOpenStatus[t]=true};m.importExcel=function(t){var u=d.devplatform_web_apiPath+"api/returnData/importExcel";j.submitFile(t,u,"loadAll",m)};m.upLoadTempFile=function(u){var t=d.devplatform_web_apiPath+"api/returnData/uploadTemplate";j.submitFile(u,t)};m.downLoadFile=function(){f.downLoadFile()};m.batchDelete=function(){var t="";if(m.choseArr.length===0){t="global.selectDelete";j.openDialog(t);return}t="global.messages.deleteConfirm";j.showConfirmDialog(t,"confirmDelete",m)};m.confirmDelete=function(){var t="";angular.forEach(m.choseArr,function(v,u){t+=v.id;if(u!=m.choseArr.length-1){t+=","}});f.deleteReturnData(t).then(function(u){if(u.statusCode==="0000"){m.loadAll();m.choseArr=[];var v="global.messages.deleteSuccess";j.openDialog(v)}})};m.$watch("formParam",function(w,v){if(w.date!=""||w.dateTo!=""){var t=j.compareTime(w.date,m.formParam.dateTo);if(!t){var u="global.timeMsg1";j.openDialog(u)}}},true)}})();