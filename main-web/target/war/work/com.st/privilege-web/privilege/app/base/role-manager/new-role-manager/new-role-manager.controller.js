(function(){angular.module("devplatformApp").controller("RoleManagerEditController",a);a.$inject=["$rootScope","PublicService","$timeout","$scope","$stateParams","RoleManagerService","$state","$compile","ngVerify","$uibModalInstance"];function a(k,j,d,o,n,f,b,g,c,m){o.menuId=n.menuId;o.clear=h;if(n.id){f.getSysRole(n.id).then(function(p){o.sysRole=p.data})}d(function(){angular.element(".form-group:eq(1)>input").focus()});o.save=function(){o.isSaving=true;if(o.sysRole.id!==null&&o.sysRole.id!==undefined){f.updateSysRole(o.sysRole).then(function(p){if(p.statusCode==="0000"){o.message="global.saveSuccess";j.showDialogTimeout(o.message);k.$broadcast("newRoleManager","");b.go("app.role-manager");o.isSaving=false}else{var q=p.msgCode;j.openDialog(q)}})}else{f.saveSysRole(o.sysRole).then(function(p){if(p.statusCode==="0000"){j.openDialog("global.saveSuccess");b.go("app.role-manager");o.isSaving=false;o.clear(true)}else{var q=p.msgCode;j.openDialog(q)}})}};var l=g(angular.element("<span style='color:red;font-size: 10px;' data-translate='devplatformApp.sysRole.regular'>编号只能为字母和数字，且长度为3到10</span>"))(o);var e=g(angular.element("<span style='color:red;font-size: 10px;' data-translate='{{repeatRoleNo}}'>该编号已存在，请重新输入</span>"))(o);var i=/^[a-zA-Z0-9]{3,10}$/;o.checkRoleNo=function(){o.isSaving=true;if(i.test(o.sysRole.roleNo)){if(l){l.remove()}f.checkRoleNo({roleNo:o.sysRole.roleNo}).then(function(p){if(p.data>0){o.repeatRoleNo=p.msgCode;angular.element("#roleNoDiv").append(e);angular.element("#roleNo").addClass("input-err");o.isSaving=true}else{if(p.data<=0){angular.element("#roleNo").removeClass("input-err");if(e){e.remove();o.isSaving=false}}}})}else{angular.element("#roleNoDiv").append(l);angular.element("#roleNo").addClass("input-err");if(e){e.remove()}}};function h(p){m.close();b.go("app.role-manager",{},{reload:p})}}})();