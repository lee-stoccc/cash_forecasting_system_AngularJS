(function(){angular.module("devplatformApp").controller("NewMenuController",a);a.$inject=["$stateParams","NewMenuService","$scope","AlertService","$state","PublicService"];function a(i,d,j,f,b,e){j.saveMenu=c;j.decrease=g;j.increase=h;j.dataTranslate="devplatformApp.newMenu.newMenu";j.menuNameError="";j.englishNameError="";j.urlError="";j.langSwitchError="";j.chnError="";j.chnEnglishNameError="";j.isOpen=false;j.menu={parentName:"",parentId:"",menuName:"",englishName:"",url:"",langSwitch:"",sort:0,state:0};j.menuId=i.menuId;if(i.type=="1"){j.dataTranslate="devplatformApp.newMenu.newMenu"}else{j.dataTranslate="devplatformApp.newMenu.reviserMenu"}if(i.id){d.getGetMenuById(i.id).then(function(k){j.menu=k.data;j.isOpen=j.menu.visible=="1"?true:false})}else{j.menu={parentName:i.parentName,parentId:i.parentId,menuName:"",englishName:"",url:"",langSwitch:"",sort:0,state:0}}function c(){if(j.menu.menuName.length===0||j.menu.englishName.length===0){if(j.menu.menuName.length===0){j.menuNameError="menuNameError"}if(j.menu.englishName.length===0){j.englishNameError="englishNameError"}if(j.menu.langSwitch.length===0){j.langSwitchError="langSwitchError"}return}for(var k=0;k<j.menu.englishName.length;k++){var m=j.menu.englishName.substr(k,1);var l=escape(m);if(l.substring(0,2)=="%u"){j.chnEnglishNameError="chnEnglishNameError";return}}for(var k=0;k<j.menu.langSwitch.length;k++){var m=j.menu.langSwitch.substr(k,1);var l=escape(m);if(l.substring(0,2)=="%u"){j.langSwitchError="langSwitchError";return}}j.menu.visible=j.isOpen?1:0;if(j.menu.id!==null&&j.menu.id!==undefined){d.updateMenu(j.menu).then(function(n){if("0000"===n.statusCode){e.openDialog("global.saveSuccess");b.go("app.menu-management",{menuId:j.menuId})}else{e.openDialog(n.msgCode)}})}else{d.createMenu(j.menu).then(function(n){if("0000"===n.statusCode){e.openDialog("global.saveSuccess");b.go("app.menu-management",{menuId:j.menuId})}else{e.openDialog(n.msgCode)}})}}function g(){j.menu.sort--;if(j.menu.sort<=0){j.menu.sort=0}}function h(){j.menu.sort++}j.$watch("menu.menuName",function(m,k,l){if(j.menu.menuName>20){j.menu.menuName=j.menu.menuName.substring(0,20)}j.menuNameError=""});j.$watch("menu.englishName",function(o,k,m){j.englishNameError="";j.chnEnglishNameError="";if(j.menu.englishName>50){j.menu.englishName=j.menu.englishName.substring(0,50)}if(j.menu.englishName!==null&&j.menu.englishName.length>0){for(var l=0;l<j.menu.englishName.length;l++){var p=j.menu.englishName.substr(l,1);var n=escape(p);if(n.substring(0,2)=="%u"){j.chnEnglishNameError="chnError";return}}}});j.$watch("menu.sort",function(m,k,l){if(j.menu.sort>20){j.menu.sort=j.menu.sort.substring(0,20)}})}})();