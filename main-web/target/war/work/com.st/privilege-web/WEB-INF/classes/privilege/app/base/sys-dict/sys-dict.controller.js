(function(){angular.module("devplatformApp").controller("SysDictManagementController",a);a.$inject=["PublicService","Upload","$window","$location","globalConstant","Principal","SysDictService","ParseLinks","AlertService","$state","paginationConstants","JhiLanguageService","$scope","$stateParams","$rootScope","ngDialog"];function a(h,t,l,i,c,y,u,n,r,v,q,f,p,w,j,k){p.currentAccount=null;p.languages=null;p.clear=o;p.deleteSysDict=g;p.importExcel=s;p.exportExcel=b;p.toEditDict=d;p.fileName="";p.sysDictManage=h.showView("sysDictManage");p.formParam={group:"",dictKey:"",dictDesc:""};p.parentGroup=w.parentGroup;p.lastParent=w.parentGroup;x();f.getAll().then(function(z){p.languages=z});y.identity().then(function(z){p.currentAccount=z});p.tablesConfig={showCheckBox:true,tableWidth:"table-default-width",tableTitles:[{title:"devplatformApp.sysDict.group",filed:"group",type:"text-btn",width:20,actions:[{actionName:"toPage(item.group)",name:"item.group",btnClass:"text-muted"}]},{title:"devplatformApp.sysDict.dictKey",filed:"dictKey",type:"text",width:"table-item-pre-1"},{title:"devplatformApp.sysDict.dictDesc",filed:"dictDesc",type:"text",width:"table-item-pre-2"},{title:"devplatformApp.sysDict.sort",filed:"sort",type:"text",width:"table-item-pre-1"},{title:"devplatformApp.sysDict.parentGroup",filed:"parentName",type:"text",width:"table-item-pre-1"},{title:"devplatformApp.sysDict.childrenCount",filed:"childrenCount",type:"text",width:"table-item-pre-1"},{title:"devplatformApp.sysDict.delFlag",filed:"delFlag",type:"btn-status",width:"table-item-pre-1",actions:[{actionName:"enableSysDict(item.id,item.delFlag)",statusList:[{status:"0",showName:"global.disabled"},{status:"1",showName:"global.enabled"}]}]},{title:"entity.action.operation",filed:"operation",type:"btn",width:"table-item-pre-3",actions:[{actionName:"toEditDict(item.id)",name:"devplatformApp.sysDict.home.edit",formEnglishName:"sysDictManage",englishName:"editBtn"}]}],url:"api/sysDict/list",formParams:{group:p.formParam.group,dictKey:p.formParam.dictKey,dictDesc:p.formParam.dictDesc,parentGroup:p.parentGroup}};p.toPage=function(z){p.formParam={group:p.formParam.group,dictKey:p.formParam.dictKey,dictDesc:p.formParam.dictDesc,parentGroup:z};p.refreshTableList(p.formParam)};p.loadAll=function(z){if(z!==null&&z!==undefined){p.parentGroup=z;x()}p.formParam={group:p.formParam.group,dictKey:p.formParam.dictKey,dictDesc:p.formParam.dictDesc,parentGroup:p.parentGroup};p.refreshTableList(p.formParam)};function d(z){v.go("app.sys-dict-edit",{parentGroup:p.formParam.parentGroup,id:""})}function e(z){r.error(z.data.message)}function o(){v.go("app.user-edit",{id:"",menuId:""})}function g(z){p.choseArr=p.getCheckValues().check;if(p.choseArr[0]==""||p.choseArr.length==0){k.openConfirm({template:"app/common/dialog.html",className:"ngdialog-theme-default",controller:["$scope",function(A){A.message="devplatformApp.sysDict.prompt.selectOne";A.type=""}]});return}p.message="devplatformApp.sysDict.delete.question";p.type="confirm";k.openConfirm({template:"app/common/dialog.html",className:"ngdialog-theme-default",scope:p,controller:["$scope",function(A){A.confirm=function(){var C="";for(var B=0;B<A.choseArr.length;B++){if(B===0){C+="'"+A.choseArr[B]+"'"}else{C+=",'"+A.choseArr[B]+"'"}}u.deleteSysDict(C).then(function(D){if(D.statusCode==="0000"){var E="devplatformApp.sysDict.prompt.deleteSuccess";h.openDialog(E)}A.loadAll(A.parentGroup)});A.closeThisDialog()}}]})}function x(){if(p.parentGroup&&p.parentGroup!=="0"){u.getSysDict({parentGroup:p.parentGroup}).then(function(z){p.sysDict=z.data;p.lastParent=z.data.parentGroup})}}function b(){if(""===p.formParam.group||""===p.formParam.dictKey||""===p.formParam.dictDesc){p.message="devplatformApp.sysDict.prompt.confirmExport";p.type="confirm";k.openConfirm({template:"app/common/dialog.html",className:"ngdialog-theme-default",scope:p,controller:["$scope",function(z){z.confirm=function(){z.closeThisDialog();u.exportExcel(z.formParam.group,z.formParam.dictKey,z.formParam.dictDesc,z.parentGroup)}}]})}else{u.exportExcel(p.formParam.group,p.formParam.dictKey,p.formParam.dictDesc,p.parentGroup)}}function s(){var A=m(p.fileName.name);if(A!==".xls"&&A!==".xlsx"){p.message="devplatformApp.sysDict.prompt.uploadNotExcel";h.showMessageDialog(p)}else{var z=c.devplatform_web_apiPath+"api/sysDict/import";t.upload({method:"post",url:z,file:p.fileName}).then(function(B){console.log(B);if(B.data.statusCode==="0000"){p.message="devplatformApp.sysDict.prompt.exportSuccess";h.showMessageDialog(p)}else{if(B.data.statusCode==="false"){p.message="devplatformApp.sysDict.prompt.importNotExcel";h.showMessageDialog(p)}else{p.message="devplatformApp.sysDict.prompt.invalidFile";h.showMessageDialog(p)}}})}}function m(z){if(z!=""){var A="."+z.replace(/.+\./,"");return A}}p.enableSysDict=function(A,z){if(z=="0"||z==null||z==undefined){p.message="devplatformApp.sysDict.prompt.confirmEnable";z="1"}else{if(z=="1"){p.message="devplatformApp.sysDict.prompt.confirmDisable";z="0"}}p.type="confirm";k.openConfirm({template:"app/common/dialog.html",className:"ngdialog-theme-default",scope:p,controller:["$scope",function(B){B.confirm=function(){u.enableSysDict({id:A,delFlag:z}).then(function(C){if(C.data.statusCode==="0000"){B.loadAll()}});B.closeThisDialog()}}]})}}})();