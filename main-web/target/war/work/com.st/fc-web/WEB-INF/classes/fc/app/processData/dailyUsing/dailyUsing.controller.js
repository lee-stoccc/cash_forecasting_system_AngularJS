(function(){angular.module("devplatformApp").controller("DailyUsingController",a);a.$inject=["FcPublicService","DailyUsingService","ngDialog","$state","$scope","PublicService","SysDictService","globalConstant","$stateParams","Upload","$translate"];function a(r,h,o,b,p,j,m,k,n,g,c){p.datePickerOpenStatus={};var i="";var e="";p.formParam={startTime:e,endTime:i};p.choseArr=[];p.init=function(){f("deTypeList","forecast.denomination");d();q();l();p.tablesConfig={showCheckBox:true,isColspan:true,checkOneAction:"checkOneAction",checkAllAction:"checkAllAction",rowSpan:3,tableTitles:[{title:"termInfo.bankName",filed:"bankName",type:"text",width:15,tipTitle:"Branch Name"},{title:"termInfo.termNo",filed:"termNo",type:"text",width:7,tipTitle:"Terminal ID"},{title:"termInfo.termType",filed:" typeName",type:"text",width:10,tipTitle:"Terminal Type"},{title:"termInfo.date",filed:"date",type:"date",width:10,tipTitle:"Date"},{title:"bankRule.whichDay",filed:"weekday",type:"text",width:10,tipTitle:"Weekday"},{title:"bankRule.holidayAdd",filed:"holidayFlag",type:"text",width:10,tipTitle:"Holiday Add"},{title:"termInfo.dailyUsing",dynamicTitles:p.colSpanData,filed:"details",chridTitle:"dictDesc",chridFiled:"count",type:"text",width:14},],url:"api/dailyUsing/page",formParams:{termNo:p.formParam.termNo,cusTermNo:p.formParam.cusTermNo,bankId:p.formParam.bankId,startTime:p.formParam.startTime,endTime:p.formParam.endTime}};p.select("#bankIdDailyUsing");p.select("#cusRegionIdDailyUsing")};p.select=function(s){angular.element(s).select2({placeholder:c.instant("global.pleaseSelect"),allowClear:true,tags:false})};p.checkOneAction=function(s){p.choseArr=[];angular.forEach(s,function(t){if(t.checked){p.choseArr.push(t)}})};p.checkAllAction=function(s){p.choseArr=[];angular.forEach(s,function(t){if(t.checked){p.choseArr.push(t)}})};function l(){r.getCusgionList().then(function(s){if(s.statusCode==="0000"){p.cusgionList=s.data}})}p.colSpanData=[];function d(){for(var s=0;s<p.deTypeList.length;s++){var t=p.deTypeList[s].dictKey;var u="forecast.denomination."+t;m.getDictListAsync(u).then(function(v){if(v.statusCode==="0000"){var w={itemList:[],type:""};w.itemList=v.data;switch(t){case"HKD":w.title=t+"(HK$)";break;case"CNY":w.title=t+"(ï¿¥)";break}p.colSpanData[s]=w}})}}function f(t,s){m.getDictListAsync(s).then(function(u){if(u.statusCode==="0000"){p[t]=u.data}})}p.bankDailyUsingSelectCheck=function(s){};p.bankDailyUsingSelectItem=function(s){};function q(){p.showCheckBox=true;r.getBanksList().then(function(s){if(s.statusCode==="0000"){p.bankList=s.data}})}p.loadAll=function(){var v=p.formParam.startTime;var t=p.formParam.endTime;var s=j.subTime(v,t);if(s.days>14){var u=c.instant("termMonitor.dateMsg",{day:s.days});j.openDialog(u);return}p.refreshTableList(p.formParam)};p.resetSearch=function(){p.formParam={};q();l();p.bankNoStr="";p.bankName=""};p.openCalendar=function(s){p.datePickerOpenStatus[s]=true};p.generationUsing=function(){b.go("app.dailyUsing-add")};p.batchDelete=function(){var s="";if(p.choseArr.length===0){s="global.selectDelete";j.openDialog(s);return}s="global.messages.deleteConfirm";j.showConfirmDialog(s,"confirmDelete",p)};p.confirmDelete=function(){var s="";angular.forEach(p.choseArr,function(u,t){s+=u.id;if(t!=p.choseArr.length-1){s+=","}});h.deleteDailyUsing(s).then(function(t){if(t.statusCode==="0000"){p.loadAll();p.choseArr=[];var u="global.messages.deleteSuccess";j.openDialog(u)}})};p.$watch("formParam",function(v,u){if(v.endTime!=""||v.startTime!=""){var s=j.compareTime(v.startTime,p.formParam.endTime);if(!s){var t="global.timeMsg1";j.openDialog(t)}}},true)}})();