(function(){angular.module("devplatformApp").controller("StockEditController",a);a.$inject=["StockService","$scope","$stateParams","$state","ngDialog","PublicService","$uibModalInstance","ngVerify","SysDictService","FcPublicService","$translate"];function a(g,m,l,b,j,h,k,e,i,p,c){m.datePickerOpenStatus={};m.disabled=false;var o=new Date();m.formParam={bankId:"",time:o,stockDetails:[{denominationList:[],type:""}],};m.init=function(){f("deTypeList","forecast.denomination");n();if(l.id){m.disabled=true;d()}};function f(r,q){i.getDictListAsync(q).then(function(s){if(s.statusCode==="0000"){m[r]=s.data;length=(s.data).length}})}m.changeCurrency=function(v,s){var t=false;if(m.formParam.stockDetails.length>1){for(var r=0;r<m.formParam.stockDetails.length;r++){if(s!=r){var q=m.formParam.stockDetails[r];if(q.type===v){t=true;break}}}}var u="forecast.denomination."+v+"";if(t){h.showDialogTimeout(v+"global.alreadyExisted");u="forecast.denomination."}i.getDictListAsync(u).then(function(w){if(w.statusCode==="0000"){angular.forEach(w.data,function(x){x.denomination=x.dictDesc;x.count=0});m.formParam.stockDetails[s]["denominationList"]=w.data}})};m.add=function(){if(m.formParam.stockDetails.length>=m.deTypeList.length){h.showDialogTimeout("global.editDenomination");return}m.formParam.stockDetails.splice(m.formParam.stockDetails.length+1,0,{denominationList:[],type:""})};m.del=function(q){if(m.formParam.stockDetails.length===1){h.showDialogTimeout("global.del");return}m.formParam.stockDetails.splice(q,1)};m.changeBank=function(q){var r={bankId:q,time:m.formParam.time};g.getBankStock(r).then(function(s){if(s.statusCode==="0000"){m.formParam.stockDetails=s.data}})};m.calculteAmount=function(q){angular.forEach(m.formParam.stockDetails,function(){})};function n(){m.showCheckBox=false;p.getBanksList().then(function(q){if(q.statusCode==="0000"){m.bankList=q.data}})}function d(){if(l.id){g.getStock(l.id).then(function(q){if(q.statusCode==="0000"){m.formParam=q.data}})}}m.save=function(){g.saveStock(m.formParam).then(function(q){if(q.statusCode==="0000"){m.message="global.saveSuccess";h.openDialog(m.message);m.clear(true)}else{m.message=q.msgCode;h.openDialog(m.message)}})};m.openCalendar=function(q){m.datePickerOpenStatus[q]=true};m.clear=function(q){k.close("close");b.go("app.stock",{},{reload:q})}}})();