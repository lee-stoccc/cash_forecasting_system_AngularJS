(function(){angular.module("devplatformApp").controller("ForecastReportformController",a);a.$inject=["$translate","SysDictService","ForecastReportService","ngDialog","$state","$scope","$timeout","PublicService","$uibModal"];function a(c,j,i,k,b,l,e,h,g){l.formParam={};l.formParam.date=new Date();l.datePickerOpenStatus={};l.dateOptions={showWeeks:false,formatDayHeader:"EEE"};l.chartList=[{id:"echartdata1"},{id:"echartdata2"}];l.echartData1={id:"echartdata1",width:"95%",height:"350px",title:"",legend:["Predicted daily consumption","Predict the full amount of the bill"],item:[""],data:[[0],[0]]};l.echartData2={id:"echartdata2",width:"95%",height:"350px",title:"",legend:["Predicted daily consumption","Predict the full amount of the bill"],item:[""],data:[[0],[0]]};l.openCalendar=function(m){l.datePickerOpenStatus[m]=true};l.getBankList=function(){i.getBankList().then(function(m){if(m.statusCode==="0000"){l.bankList=m.data}})};l.getTermNoList=function(){i.getTermNoList({cusRegionId:l.formParam.regionName,bankId:l.formParam.bankName,termType:l.formParam.termType,termNo:l.formParam.termNo}).then(function(m){if(m.statusCode==="0000"){l.TermNoList=m.data}})};l.init=function(){l.getBankList();f("termTypeList","forecast.termType");l.getCusgionList();l.getTermNoList();angular.element("#termNo").select2({placeholder:c.instant("global.pleaseSelect"),allowClear:true,tags:true})};l.bankSelectItem=function(m){};l.bankSelectCheck=function(m){};l.getCusgionList=function(){i.getCusgionList().then(function(m){if(m.statusCode==="0000"){l.cusgionList=m.data}})};function f(n,m){j.getDictListAsync(m).then(function(o){if(o.statusCode==="0000"){l[n]=o.data}})}l.resetSearch=function(){l.formParam={};l.formParam.date=new Date()};l.loadAll=function(){var m="";if(l.formParam.termNo==null||l.formParam.termNo==""){m="global.inputTermNo";h.openDialog(m);return}if(l.formParam.date==null||l.formParam.date==""){m="global.inputDate";h.openDialog(m);return}i.getHistoryList(l.formParam).then(function(n){if(n.statusCode==="0000"){d(n.data.forecastList,"echartdata1");d(n.data.historyList,"echartdata2")}})};function d(o,p){var m=[];var n=[[0],[0]];if(o==null||o.length==0){return}angular.forEach(o,function(q,s){var r=h.formatDate(q.replenishDate,"yyyy-MM-dd");if(m.length<=s){m[s]=r;n[0][s]=0;n[1][s]=0}n[0][s]+=q.usingAmount;n[1][s]+=q.replenishAmount});l.refreshEchart(p,{item:m,legend:["预测日用量","预测加钞全额"],data:n})}}})();