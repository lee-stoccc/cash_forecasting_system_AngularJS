(function(){angular.module("devplatformApp").controller("EventEditController",a);a.$inject=["$rootScope","SysDictService","PublicService","EventManagementService","ngDialog","$state","$scope","$stateParams","$uibModalInstance","$translate"];function a(k,j,h,g,m,b,o,n,l,d){o.init=function(){};o.formParam={};o.formParam.startDate=new Date();o.formParam.endDate=new Date();o.datePickerOpenStatus={};o.dateOptions={showWeeks:false,formatDayHeader:"EEE"};o.replenishRule=[{value:d.instant("eventManagement.Monday"),key:1},{value:d.instant("eventManagement.Tuesday"),key:2},{value:d.instant("eventManagement.Wednesday"),key:3},{value:d.instant("eventManagement.Thursday"),key:4},{value:d.instant("eventManagement.Friday"),key:5},{value:d.instant("eventManagement.Saturday"),key:6},{value:d.instant("eventManagement.Sunday"),key:7}];o.workday=o.replenishRule.slice(0,5);o.clear=function(p){l.close();b.go("app.eventManagement",{},{reload:p})};o.formParam.ceiling="";o.formParam.lowest="";o.initData=function(){f("eventTypeList","forecast.event.category");f("regionList","forecast.region");e()};function e(){if(n.id){o.type="edit";var p=n.id;g.getEvent(n.id).then(function(q){if(q.statusCode==="0000"){o.formParam=q.data;i(o.formParam);var r="forecast.event.category."+q.data.eventType;o.formParam.eventCategoryList=f("eventCategoryList",r);o.formParam.region=o.getRegionKey(o.regionList,q.data.region);o.formParam.endDate=dateToGMT(q.data.endDate);o.formParam.startDate=dateToGMT(q.data.startDate);angular.forEach(o.dateObj,function(s){s.startDate=dateToGMT(s.startDate);s.endDate=dateToGMT(s.endDate)})}})}}function i(p){var q=h.showData(p.replenishRule,o.replenishRule);o.select_all=q.selectAll;o.select_workDay=q.selectWorkDay;o.amount=0;angular.forEach(o.formParam.stockCeilings,function(r){angular.forEach(r.denominationList,function(s){o.amount+=parseFloat(s.denomination,10)*s.count})})}o.selectAll=function(){if(o.select_all){o.select_workDay=false;o.flagChecked(o.replenishRule,true)}else{o.flagChecked(o.replenishRule,false)}};o.selectWorkDay=function(){o.flagChecked(o.replenishRule,false);if(o.select_workDay){o.select_all=false;o.flagChecked(o.workday,true)}else{o.flagChecked(o.workday,false)}};o.selectOne=function(){var p=h.calcWorkDayOrAll(o.replenishRule);o.select_workDay=p.selectWorkDay;o.select_all=p.selectAll};function c(){var p=h.getCashDay(o.replenishRule);o.formParam.replenishRule=p.replenishRule;return p.flag}o.save=function(){c();if(o.formParam.endDate!=undefined||params.startDate!==null){var s=o.formParam.endDate;if(typeof s=="object"){var r=s.getTime();o.formParam.endDate=s.setTime(r+1000*200)}}if(o.formParam.startDate!=undefined||params.startDate!==null){var s=o.formParam.startDate;if(typeof s=="object"){var r=s.getTime();o.formParam.startDate=s.setTime(r+1000*200)}}var p=o.regionList;var q=o.formParam.region;o.formParam.region=o.getRegionDesc(p,q);if(o.formParam.ceiling<o.formParam.lowest){var t="global.compareCash";h.showDialogTimeout(t);return}g.saveEvent(o.formParam).then(function(u){if(u.statusCode==="0000"){o.message="global.saveSuccess";h.showDialogTimeout(o.message);k.$broadcast("rootEventEdit","");o.clear(false)}})};o.getRegionDesc=function(r,q){for(var p=0;p<r.length;p++){if(r[p]["dictKey"]==q){return r[p]["dictDesc"]}}};o.getRegionKey=function(q,r){for(var p=0;p<q.length;p++){if(q[p]["dictDesc"]==r){return q[p]["dictKey"]}}};function f(q,p){j.getDictListAsync(p).then(function(r){if(r.statusCode==="0000"){o[q]=r.data}})}o.changeEventType=function(p){var p="forecast.event.category."+p;o.formParam.eventCategoryList=f("eventCategoryList",p);var q=o.formParam.eventCategoryList};o.flagChecked=function(p,q){angular.forEach(p,function(r){r.checked=q})};o.openCalendar=function(p){o.datePickerOpenStatus[p]=true};o.checkStartTime=function(){if(o.formParam.startDate>o.formParam.endDate){var p="global.timeMsg1";h.openDialog(p);o.formParam.startDate=new Date()}};o.checkEndTime=function(){if(o.formParam.startDate>o.formParam.endDate){var p="global.timeMsg2";h.openDialog(p);o.formParam.endDate=new Date()}}}})();