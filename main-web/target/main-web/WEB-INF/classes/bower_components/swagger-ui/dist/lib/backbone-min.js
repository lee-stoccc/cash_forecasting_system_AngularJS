(function(b,c){if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(d,f,e){b.Backbone=c(b,e,d,f)})}else{if(typeof exports!=="undefined"){var a=require("underscore");c(b,exports,a)}else{b.Backbone=c(b,{},b._,b.jQuery||b.Zepto||b.ender||b.$)}}})(this,function(af,av,aq,ah){var ag=af.Backbone;var al=[];var az=al.push;var ak=al.slice;var ar=al.splice;av.VERSION="1.1.2";av.$=ah;av.noConflict=function(){af.Backbone=ag;return this};av.emulateHTTP=false;av.emulateJSON=false;var ae=av.Events={on:function(b,d,a){if(!ax(this,"on",b,[d,a])||!d){return this}this._events||(this._events={});var c=this._events[b]||(this._events[b]=[]);c.push({callback:d,context:a,ctx:a||this});return this},once:function(a,d,c){if(!ax(this,"once",a,[d,c])||!d){return this}var b=this;var f=aq.once(function(){b.off(a,f);d.apply(this,arguments)});f._callback=d;return this.on(a,f,c)},off:function(q,k,b){var v,d,m,c,i,p,g,j;if(!this._events||!ax(this,"off",q,[k,b])){return this}if(!q&&!k&&!b){this._events=void 0;return this}c=q?[q]:aq.keys(this._events);for(i=0,p=c.length;i<p;i++){q=c[i];if(m=this._events[q]){this._events[q]=v=[];if(k||b){for(g=0,j=m.length;g<j;g++){d=m[g];if(k&&k!==d.callback&&k!==d.callback._callback||b&&b!==d.context){v.push(d)}}}if(!v.length){delete this._events[q]}}}return this},trigger:function(b){if(!this._events){return this}var d=ak.call(arguments,1);if(!ax(this,"trigger",b,d)){return this}var a=this._events[b];var c=this._events.all;if(a){au(a,d)}if(c){au(c,arguments)}return this},stopListening:function(c,g,f){var d=this._listeningTo;if(!d){return this}var h=!g&&!f;if(!f&&typeof g==="object"){f=this}if(c){(d={})[c._listenId]=c}for(var b in d){c=d[b];c.off(g,f,this);if(h||aq.isEmpty(c._events)){delete this._listeningTo[b]}}return this}};var an=/\s+/;var ax=function(d,h,c,g){if(!c){return true}if(typeof c==="object"){for(var f in c){d[h].apply(d,[f,c[f]].concat(g))}return false}if(an.test(c)){var k=c.split(an);for(var b=0,j=k.length;b<j;b++){d[h].apply(d,[k[b]].concat(g))}return false}return true};var au=function(d,h){var c,g=-1,f=d.length,k=h[0],b=h[1],j=h[2];switch(h.length){case 0:while(++g<f){(c=d[g]).callback.call(c.ctx)}return;case 1:while(++g<f){(c=d[g]).callback.call(c.ctx,k)}return;case 2:while(++g<f){(c=d[g]).callback.call(c.ctx,k,b)}return;case 3:while(++g<f){(c=d[g]).callback.call(c.ctx,k,b,j)}return;default:while(++g<f){(c=d[g]).callback.apply(c.ctx,h)}return}};var aw={listenTo:"on",listenToOnce:"once"};aq.each(aw,function(a,b){ae[b]=function(g,f,d){var h=this._listeningTo||(this._listeningTo={});var c=g._listenId||(g._listenId=aq.uniqueId("l"));h[c]=g;if(!d&&typeof f==="object"){d=this}g[a](f,d,this);return this}});ae.bind=ae.on;ae.unbind=ae.off;aq.extend(av,ae);var aj=av.Model=function(a,c){var b=a||{};c||(c={});this.cid=aq.uniqueId("c");this.attributes={};if(c.collection){this.collection=c.collection}if(c.parse){b=this.parse(b,c)||{}}b=aq.defaults({},b,aq.result(this,"defaults"));this.set(b,c);this.changed={};this.initialize.apply(this,arguments)};aq.extend(aj.prototype,ae,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return aq.clone(this.attributes)},sync:function(){return av.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return aq.escape(this.get(a))},has:function(a){return this.get(a)!=null},set:function(y,p,b){var A,i,w,g,k,x,j,v;if(y==null){return this}if(typeof y==="object"){i=y;b=p}else{(i={})[y]=p}b||(b={});if(!this._validate(i,b)){return false}w=b.unset;k=b.silent;g=[];x=this._changing;this._changing=true;if(!x){this._previousAttributes=aq.clone(this.attributes);this.changed={}}v=this.attributes,j=this._previousAttributes;if(this.idAttribute in i){this.id=i[this.idAttribute]}for(A in i){p=i[A];if(!aq.isEqual(v[A],p)){g.push(A)}if(!aq.isEqual(j[A],p)){this.changed[A]=p}else{delete this.changed[A]}w?delete v[A]:v[A]=p}if(!k){if(g.length){this._pending=b}for(var m=0,q=g.length;m<q;m++){this.trigger("change:"+g[m],this,v[g[m]],b)}}if(x){return this}if(!k){while(this._pending){b=this._pending;this._pending=false;this.trigger("change",this,b)}}this._pending=false;this._changing=false;return this},unset:function(a,b){return this.set(a,void 0,aq.extend({},b,{unset:true}))},clear:function(a){var c={};for(var b in this.attributes){c[b]=void 0}return this.set(c,aq.extend({},a,{unset:true}))},hasChanged:function(a){if(a==null){return !aq.isEmpty(this.changed)}return aq.has(this.changed,a)},changedAttributes:function(a){if(!a){return this.hasChanged()?aq.clone(this.changed):false}var d,c=false;var b=this._changing?this._previousAttributes:this.attributes;for(var f in a){if(aq.isEqual(b[f],d=a[f])){continue}(c||(c={}))[f]=d}return c},previous:function(a){if(a==null||!this._previousAttributes){return null}return this._previousAttributes[a]},previousAttributes:function(){return aq.clone(this._previousAttributes)},fetch:function(a){a=a?aq.clone(a):{};if(a.parse===void 0){a.parse=true}var c=this;var b=a.success;a.success=function(d){if(!c.set(c.parse(d,a),a)){return false}if(b){b(c,d,a)}c.trigger("sync",c,d,a)};ai(this,a);return this.sync("read",this,a)},save:function(k,g,b){var l,d,i,c=this.attributes;if(k==null||typeof k==="object"){l=k;b=g}else{(l={})[k]=g}b=aq.extend({validate:true},b);if(l&&!b.wait){if(!this.set(l,b)){return false}}else{if(!this._validate(l,b)){return false}}if(l&&b.wait){this.attributes=aq.extend({},c,l)}if(b.parse===void 0){b.parse=true}var f=this;var j=b.success;b.success=function(a){f.attributes=c;var h=f.parse(a,b);if(b.wait){h=aq.extend(l||{},h)}if(aq.isObject(h)&&!f.set(h,b)){return false}if(j){j(f,a,b)}f.trigger("sync",f,a,b)};ai(this,b);d=this.isNew()?"create":b.patch?"patch":"update";if(d==="patch"){b.attrs=l}i=this.sync(d,this,b);if(l&&b.wait){this.attributes=c}return i},destroy:function(a){a=a?aq.clone(a):{};var d=this;var c=a.success;var b=function(){d.trigger("destroy",d,d.collection,a)};a.success=function(e){if(a.wait||d.isNew()){b()}if(c){c(d,e,a)}if(!d.isNew()){d.trigger("sync",d,e,a)}};if(this.isNew()){a.success();return false}ai(this,a);var f=this.sync("delete",this,a);if(!a.wait){b()}return f},url:function(){var a=aq.result(this,"urlRoot")||aq.result(this.collection,"url")||L();if(this.isNew()){return a}return a.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(a){return this._validate({},aq.extend(a||{},{validate:true}))},_validate:function(a,c){if(!c.validate||!this.validate){return true}a=aq.extend({},this.attributes,a);var b=this.validationError=this.validate(a,c)||null;if(!b){return true}this.trigger("invalid",this,b,aq.extend(c,{validationError:b}));return false}});var ad=["keys","values","pairs","invert","pick","omit"];aq.each(ad,function(a){aj.prototype[a]=function(){var b=ak.call(arguments);b.unshift(this.attributes);return aq[a].apply(aq,b)}});var at=av.Collection=function(a,b){b||(b={});if(b.model){this.model=b.model}if(b.comparator!==void 0){this.comparator=b.comparator}this._reset();this.initialize.apply(this,arguments);if(a){this.reset(a,aq.extend({silent:true},b))}};var am={add:true,remove:true,merge:true};var aa={add:true,remove:false};aq.extend(at.prototype,ae,{model:aj,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return av.sync.apply(this,arguments)},add:function(a,b){return this.set(a,aq.extend({merge:false},b,aa))},remove:function(c,g){var f=!aq.isArray(c);c=f?[c]:aq.clone(c);g||(g={});var d,i,b,h;for(d=0,i=c.length;d<i;d++){h=c[d]=this.get(c[d]);if(!h){continue}delete this._byId[h.id];delete this._byId[h.cid];b=this.indexOf(h);this.models.splice(b,1);this.length--;if(!g.silent){g.index=b;h.trigger("remove",h,this,g)}this._removeReference(h,g)}return f?c[0]:c},set:function(C,U){U=aq.defaults({},U,am);if(U.parse){C=this.parse(C,U)}var I=!aq.isArray(C);C=I?C?[C]:[]:aq.clone(C);var H,N,aE,M,R,q,O;var aC=U.at;var T=this.model;var aB=this.comparator&&aC==null&&U.sort!==false;var p=aq.isString(this.comparator)?this.comparator:null;var S=[],i=[],aF={};var aD=U.add,m=U.merge,j=U.remove;var A=!aB&&aD&&j?[]:false;for(H=0,N=C.length;H<N;H++){R=C[H]||{};if(R instanceof aj){aE=M=R}else{aE=R[T.prototype.idAttribute||"id"]}if(q=this.get(aE)){if(j){aF[q.cid]=true}if(m){R=R===M?M.attributes:R;if(U.parse){R=q.parse(R,U)}q.set(R,U);if(aB&&!O&&q.hasChanged(p)){O=true}}C[H]=q}else{if(aD){M=C[H]=this._prepareModel(R,U);if(!M){continue}S.push(M);this._addReference(M,U)}}M=q||M;if(A&&(M.isNew()||!aF[M.id])){A.push(M)}aF[M.id]=true}if(j){for(H=0,N=this.length;H<N;++H){if(!aF[(M=this.models[H]).cid]){i.push(M)}}if(i.length){this.remove(i,U)}}if(S.length||A&&A.length){if(aB){O=true}this.length+=S.length;if(aC!=null){for(H=0,N=S.length;H<N;H++){this.models.splice(aC+H,0,S[H])}}else{if(A){this.models.length=0}var P=A||S;for(H=0,N=P.length;H<N;H++){this.models.push(P[H])}}}if(O){this.sort({silent:true})}if(!U.silent){for(H=0,N=S.length;H<N;H++){(M=S[H]).trigger("add",M,this,U)}if(O||A&&A.length){this.trigger("sort",this,U)}}return I?C[0]:C},reset:function(a,d){d||(d={});for(var c=0,b=this.models.length;c<b;c++){this._removeReference(this.models[c],d)}d.previousModels=this.models;this._reset();a=this.add(a,aq.extend({silent:true},d));if(!d.silent){this.trigger("reset",this,d)}return a},push:function(a,b){return this.add(a,aq.extend({at:this.length},b))},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){return this.add(a,aq.extend({at:0},b))},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(){return ak.apply(this.models,arguments)},get:function(a){if(a==null){return void 0}return this._byId[a]||this._byId[a.id]||this._byId[a.cid]},at:function(a){return this.models[a]},where:function(a,b){if(aq.isEmpty(a)){return b?void 0:[]}return this[b?"find":"filter"](function(d){for(var c in a){if(a[c]!==d.get(c)){return false}}return true})},findWhere:function(a){return this.where(a,true)},sort:function(a){if(!this.comparator){throw new Error("Cannot sort a set without a comparator")}a||(a={});if(aq.isString(this.comparator)||this.comparator.length===1){this.models=this.sortBy(this.comparator,this)}else{this.models.sort(aq.bind(this.comparator,this))}if(!a.silent){this.trigger("sort",this,a)}return this},pluck:function(a){return aq.invoke(this.models,"get",a)},fetch:function(a){a=a?aq.clone(a):{};if(a.parse===void 0){a.parse=true}var c=a.success;var b=this;a.success=function(d){var e=a.reset?"reset":"set";b[e](d,a);if(c){c(b,d,a)}b.trigger("sync",b,d,a)};ai(this,a);return this.sync("read",this,a)},create:function(a,d){d=d?aq.clone(d):{};if(!(a=this._prepareModel(a,d))){return false}if(!d.wait){this.add(a,d)}var c=this;var b=d.success;d.success=function(f,e){if(d.wait){c.add(f,d)}if(b){b(f,e,d)}};a.save(null,d);return a},parse:function(a,b){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(a,c){if(a instanceof aj){return a}c=c?aq.clone(c):{};c.collection=this;var b=new this.model(a,c);if(!b.validationError){return b}this.trigger("invalid",this,b.validationError,c);return false},_addReference:function(a,b){this._byId[a.cid]=a;if(a.id!=null){this._byId[a.id]=a}if(!a.collection){a.collection=this}a.on("all",this._onModelEvent,this)},_removeReference:function(a,b){if(this===a.collection){delete a.collection}a.off("all",this._onModelEvent,this)},_onModelEvent:function(b,d,a,c){if((b==="add"||b==="remove")&&a!==this){return}if(b==="destroy"){this.remove(d,c)}if(d&&b==="change:"+d.idAttribute){delete this._byId[d.previous(d.idAttribute)];if(d.id!=null){this._byId[d.id]=d}}this.trigger.apply(this,arguments)}});var aA=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];aq.each(aA,function(a){at.prototype[a]=function(){var b=ak.call(arguments);b.unshift(this.models);return aq[a].apply(aq,b)}});var ay=["groupBy","countBy","sortBy","indexBy"];aq.each(ay,function(a){at.prototype[a]=function(d,c){var b=aq.isFunction(d)?d:function(e){return e.get(d)};return aq[a](this.models,b,c)}});var ac=av.View=function(a){this.cid=aq.uniqueId("view");a||(a={});aq.extend(this,aq.pick(a,W));this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()};var ab=/^(\S+)\s*(.*)$/;var W=["model","collection","el","id","attributes","className","tagName","events"];aq.extend(ac.prototype,ae,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},setElement:function(b,a){if(this.$el){this.undelegateEvents()}this.$el=b instanceof av.$?b:av.$(b);this.el=this.$el[0];if(a!==false){this.delegateEvents()}return this},delegateEvents:function(c){if(!(c||(c=aq.result(this,"events")))){return this}this.undelegateEvents();for(var g in c){var f=c[g];if(!aq.isFunction(f)){f=this[c[g]]}if(!f){continue}var d=g.match(ab);var h=d[1],b=d[2];f=aq.bind(f,this);h+=".delegateEvents"+this.cid;if(b===""){this.$el.on(h,f)}else{this.$el.on(h,b,f)}}return this},undelegateEvents:function(){this.$el.off(".delegateEvents"+this.cid);return this},_ensureElement:function(){if(!this.el){var a=aq.extend({},aq.result(this,"attributes"));if(this.id){a.id=aq.result(this,"id")}if(this.className){a["class"]=aq.result(this,"className")}var b=av.$("<"+aq.result(this,"tagName")+">").attr(a);this.setElement(b,false)}else{this.setElement(aq.result(this,"el"),false)}}});av.sync=function(c,f,e){var i=B[c];aq.defaults(e||(e={}),{emulateHTTP:av.emulateHTTP,emulateJSON:av.emulateJSON});var b={type:i,dataType:"json"};if(!e.url){b.url=aq.result(f,"url")||L()}if(e.data==null&&f&&(c==="create"||c==="update"||c==="patch")){b.contentType="application/json";b.data=JSON.stringify(e.attrs||f.toJSON(e))}if(e.emulateJSON){b.contentType="application/x-www-form-urlencoded";b.data=b.data?{model:b.data}:{}}if(e.emulateHTTP&&(i==="PUT"||i==="DELETE"||i==="PATCH")){b.type="POST";if(e.emulateJSON){b.data._method=i}var g=e.beforeSend;e.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",i);if(g){return g.apply(this,arguments)}}}if(b.type!=="GET"&&!e.emulateJSON){b.processData=false}if(b.type==="PATCH"&&ao){b.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}var d=e.xhr=av.ajax(aq.extend(b,e));f.trigger("request",f,d,e);return d};var ao=typeof window!=="undefined"&&!!window.ActiveXObject&&!(window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent);var B={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};av.ajax=function(){return av.$.ajax.apply(av.$,arguments)};var Z=av.Router=function(a){a||(a={});if(a.routes){this.routes=a.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var D=/\((.*?)\)/g;var V=/(\(\?)?:\w+/g;var Y=/\*\w+/g;var Q=/[\-{}\[\]+?.,\\\^$|#\s]/g;aq.extend(Z.prototype,ae,{initialize:function(){},route:function(a,c,b){if(!aq.isRegExp(a)){a=this._routeToRegExp(a)}if(aq.isFunction(c)){b=c;c=""}if(!b){b=this[c]}var d=this;av.history.route(a,function(f){var e=d._extractParameters(a,f);d.execute(b,e);d.trigger.apply(d,["route:"+c].concat(e));d.trigger("route",c,e);av.history.trigger("route",d,c,e)});return this},execute:function(a,b){if(a){a.apply(this,b)}},navigate:function(b,a){av.history.navigate(b,a);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=aq.result(this,"routes");var a,b=aq.keys(this.routes);while((a=b.pop())!=null){this.route(a,this.routes[a])}},_routeToRegExp:function(a){a=a.replace(Q,"\\$&").replace(D,"(?:$1)?").replace(V,function(b,c){return c?b:"([^/?]+)"}).replace(Y,"([^?]*?)");return new RegExp("^"+a+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(a,c){var b=a.exec(c).slice(1);return aq.map(b,function(d,f){if(f===b.length-1){return d||null}return d?decodeURIComponent(d):null})}});var K=av.History=function(){this.handlers=[];aq.bindAll(this,"checkUrl");if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var F=/^[#\/]|\s+$/g;var J=/^\/+|\/+$/g;var G=/msie [\w.]+/;var X=/\/$/;var ap=/#.*$/;K.started=false;aq.extend(K.prototype,ae,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(b,c){if(b==null){if(this._hasPushState||!this._wantsHashChange||c){b=decodeURI(this.location.pathname+this.location.search);var a=this.root.replace(X,"");if(!b.indexOf(a)){b=b.slice(a.length)}}else{b=this.getHash()}}return b.replace(F,"")},start:function(c){if(K.started){throw new Error("Backbone.history has already been started")}K.started=true;this.options=aq.extend({root:"/"},this.options,c);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var e=this.getFragment();var d=document.documentMode;var g=G.exec(navigator.userAgent.toLowerCase())&&(!d||d<=7);this.root=("/"+this.root+"/").replace(J,"/");if(g&&this._wantsHashChange){var b=av.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=b.hide().appendTo("body")[0].contentWindow;this.navigate(e)}if(this._hasPushState){av.$(window).on("popstate",this.checkUrl)}else{if(this._wantsHashChange&&"onhashchange" in window&&!g){av.$(window).on("hashchange",this.checkUrl)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}this.fragment=e;var f=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){this.fragment=this.getFragment(null,true);this.location.replace(this.root+"#"+this.fragment);return true}else{if(this._hasPushState&&this.atRoot()&&f.hash){this.fragment=this.getHash().replace(F,"");this.history.replaceState({},document.title,this.root+this.fragment)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){av.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl);if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}K.started=false},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();if(b===this.fragment&&this.iframe){b=this.getFragment(this.getHash(this.iframe))}if(b===this.fragment){return false}if(this.iframe){this.navigate(b)}this.loadUrl()},loadUrl:function(a){a=this.fragment=this.getFragment(a);return aq.any(this.handlers,function(b){if(b.route.test(a)){b.callback(a);return true}})},navigate:function(b,c){if(!K.started){return false}if(!c||c===true){c={trigger:!!c}}var a=this.root+(b=this.getFragment(b||""));b=b.replace(ap,"");if(this.fragment===b){return}this.fragment=b;if(b===""&&a!=="/"){a=a.slice(0,-1)}if(this._hasPushState){this.history[c.replace?"replaceState":"pushState"]({},document.title,a)}else{if(this._wantsHashChange){this._updateHash(this.location,b,c.replace);if(this.iframe&&b!==this.getFragment(this.getHash(this.iframe))){if(!c.replace){this.iframe.document.open().close()}this._updateHash(this.iframe.location,b,c.replace)}}else{return this.location.assign(a)}}if(c.trigger){return this.loadUrl(b)}},_updateHash:function(b,d,a){if(a){var c=b.href.replace(/(javascript:|#).*$/,"");b.replace(c+"#"+d)}else{b.hash="#"+d}}});av.history=new K;var z=function(a,d){var c=this;var b;if(a&&aq.has(a,"constructor")){b=a.constructor}else{b=function(){return c.apply(this,arguments)}}aq.extend(b,c,d);var f=function(){this.constructor=b};f.prototype=c.prototype;b.prototype=new f;if(a){aq.extend(b.prototype,a)}b.__super__=c.prototype;return b};aj.extend=at.extend=Z.extend=ac.extend=K.extend=z;var L=function(){throw new Error('A "url" property or function must be specified')};var ai=function(b,c){var a=c.error;c.error=function(d){if(a){a(b,d,c)}b.trigger("error",b,d,c)}};return av});Backbone.View=(function(a){return a.extend({constructor:function(b){this.options=b||{};a.apply(this,arguments)}})})(Backbone.View);