"use strict";SwaggerUi.Views.OperationView=Backbone.View.extend({invocationUrl:null,events:{"submit .sandbox":"submitOperation","click .submit":"submitOperation","click .response_hider":"hideResponse","click .toggleOperation":"toggleOperationContent","mouseenter .api-ic":"mouseEnter","dblclick .curl":"selectText","change [name=responseContentType]":"showSnippet"},initialize:function(a){a=a||{};this.router=a.router;this.auths=a.auths;this.parentId=this.model.parentId;this.nickname=this.model.nickname;this.model.encodedParentId=encodeURIComponent(this.parentId);if(a.swaggerOptions){this.model.defaultRendering=a.swaggerOptions.defaultModelRendering;if(a.swaggerOptions.showRequestHeaders){this.model.showRequestHeaders=true}}return this},selectText:function(c){var d=document,e=c.target.firstChild,a,b;if(d.body.createTextRange){a=document.body.createTextRange();a.moveToElementText(e);a.select()}else{if(window.getSelection){b=window.getSelection();a=document.createRange();a.selectNodeContents(e);b.removeAllRanges();b.addRange(a)}}},mouseEnter:function(g){var f=$(this.el).find(".content");var l=g.pageX;var j=g.pageY;var k=$(window).scrollLeft();var h=$(window).scrollTop();var b=k+$(window).width();var a=h+$(window).height();var d=f.width();var c=f.height();if(l+d>b){l=b-d}if(l<k){l=k}if(j+c>a){j=a-c}if(j<h){j=h}var i={};i.top=j;i.left=l;f.css(i)},render:function(){var W,w,U,c,G,F,S,z,R,A,i,h,g,f,P,B,O,N,M,e,L,J,u,t,s,r,j,d,E,H,Q,D,V,b,Y,X,I,K,y,x,T;F=jQuery.inArray(this.model.method,this.model.supportedSubmitMethods())>=0;if(!F){this.model.isReadOnly=true}this.model.description=this.model.description||this.model.notes;this.model.oauth=null;B=this.model.authorizations||this.model.security;if(B){if(Array.isArray(B)){for(R=0,A=B.length;R<A;R++){U=B[R];for(z in U){for(W in this.auths){w=this.auths[W];if(z===w.name){if(w.type==="oauth2"){this.model.oauth={};this.model.oauth.scopes=[];u=w.value.scopes;for(S in u){I=u[S];D=U[z].indexOf(S);if(D>=0){N={scope:S,description:I};this.model.oauth.scopes.push(N)}}}}}}}}else{for(S in B){I=B[S];if(S==="oauth2"){if(this.model.oauth===null){this.model.oauth={}}if(this.model.oauth.scopes===void 0){this.model.oauth.scopes=[]}for(P=0,i=I.length;P<i;P++){N=I[P];this.model.oauth.scopes.push(N)}}}}}if(typeof this.model.responses!=="undefined"){this.model.responseMessages=[];t=this.model.responses;for(c in t){K=t[c];H=null;Q=this.model.responses[c].schema;if(Q&&Q.$ref){H=Q.$ref;if(H.indexOf("#/definitions/")!==-1){H=H.replace(/^.*#\/definitions\//,"")}}this.model.responseMessages.push({code:c,message:K.description,responseModel:H,headers:K.headers,schema:Q})}}if(typeof this.model.responseMessages==="undefined"){this.model.responseMessages=[]}V=null;y=this.model.produces;x=this.contains(y,"xml");T=x?this.contains(y,"json"):true;if(this.model.successResponse){Y=this.model.successResponse;for(z in Y){K=Y[z];this.model.successCode=z;if(typeof K==="object"&&typeof K.createJSONSample==="function"){this.model.successDescription=K.description;this.model.headers=this.parseResponseHeaders(K.headers);V={sampleJSON:T?JSON.stringify(SwaggerUi.partials.signature.createJSONSample(K),void 0,2):false,isParam:false,sampleXML:x?SwaggerUi.partials.signature.createXMLSample(K.name,K.definition,K.models):false,signature:SwaggerUi.partials.signature.getModelSignature(K.name,K.definition,K.models,K.modelPropertyMacro)}}else{V={signature:SwaggerUi.partials.signature.getPrimitiveSignature(K)}}}}else{if(this.model.responseClassSignature&&this.model.responseClassSignature!=="string"){V={sampleJSON:this.model.responseSampleJSON,isParam:false,signature:this.model.responseClassSignature}}}$(this.el).html(Handlebars.templates.operation(this.model));if(V){V.defaultRendering=this.model.defaultRendering;E=new SwaggerUi.Views.SignatureView({model:V,router:this.router,tagName:"div"});$(".model-signature",$(this.el)).append(E.render().el)}else{this.model.responseClassSignature="string";$(".model-signature",$(this.el)).html(this.model.type)}G={isParam:false};G.consumes=this.model.consumes;G.produces=this.model.produces;s=this.model.parameters;for(O=0,h=s.length;O<h;O++){e=s[O];X=e.type||e.dataType||"";if(typeof X==="undefined"){H=e.schema;if(H&&H.$ref){J=H.$ref;if(J.indexOf("#/definitions/")===0){X=J.substring("#/definitions/".length)}else{X=J}}}if(X&&X.toLowerCase()==="file"){if(!G.consumes){G.consumes="multipart/form-data"}}e.type=X}d=new SwaggerUi.Views.ResponseContentTypeView({model:G,router:this.router});$(".response-content-type",$(this.el)).append(d.render().el);r=this.model.parameters;for(M=0,g=r.length;M<g;M++){e=r[M];this.addParameter(e,G.consumes)}j=this.model.responseMessages;for(L=0,f=j.length;L<f;L++){b=j[L];b.isXML=x;b.isJSON=T;if(!_.isUndefined(b.headers)){b.headers=this.parseHeadersType(b.headers)}this.addStatusCode(b)}if(Array.isArray(this.model.security)){var C=SwaggerUi.utils.parseSecurityDefinitions(this.model.security);C.isLogout=!_.isEmpty(window.swaggerUi.api.clientAuthorizations.authz);this.authView=new SwaggerUi.Views.AuthButtonView({data:C,router:this.router,isOperation:true,model:{scopes:C.scopes}});this.$(".authorize-wrapper").append(this.authView.render().el)}this.showSnippet();return this},parseHeadersType:function(b){var a={string:{"date-time":"dateTime",date:"date"}};_.forEach(b,function(d){var c;d=d||{};c=a[d.type]&&a[d.type][d.format];if(!_.isUndefined(c)){d.type=c}});return b},contains:function(a,b){return a.filter(function(c){if(c.indexOf(b)>-1){return true}}).length},parseResponseHeaders:function(a){var c="; ";var b=_.clone(a);_.forEach(b,function(e){var d=[];_.forEach(e,function(h,g){var f=["type","description"];if(f.indexOf(g.toLowerCase())===-1){d.push(g+": "+h)}});d.join(c);e.other=d});return b},addParameter:function(c,a){c.consumes=a;c.defaultRendering=this.model.defaultRendering;if(c.schema){$.extend(true,c.schema,this.model.definitions[c.type]);c.schema.definitions=this.model.definitions;if(!c.schema.type){c.schema.type="object"}if(!c.schema.title){c.schema.title=" "}}var b=new SwaggerUi.Views.ParameterView({model:c,tagName:"tr",readOnly:this.model.isReadOnly,swaggerOptions:this.options.swaggerOptions});$(".operation-params",$(this.el)).append(b.render().el)},addStatusCode:function(b){b.defaultRendering=this.model.defaultRendering;var a=new SwaggerUi.Views.StatusCodeView({model:b,tagName:"tr",router:this.router});$(".operation-status",$(this.el)).append(a.render().el)},submitOperation:function(h){var i,d,g,b,a;if(h!==null){h.preventDefault()}d=$(".sandbox",$(this.el));i=true;d.find("input.required").each(function(){$(this).removeClass("error");if(jQuery.trim($(this).val())===""){$(this).addClass("error");$(this).wiggle({callback:(function(e){return function(){$(e).focus()}})(this)});i=false}});d.find("textarea.required:visible").each(function(){$(this).removeClass("error");if(jQuery.trim($(this).val())===""){$(this).addClass("error");$(this).wiggle({callback:(function(e){return function(){return $(e).focus()}})(this)});i=false}});d.find("select.required").each(function(){$(this).removeClass("error");if(this.selectedIndex===-1){$(this).addClass("error");$(this).wiggle({callback:(function(e){return function(){$(e).focus()}})(this)});i=false}});if(i){b=this.getInputMap(d);g=this.isFileUpload(d);a={parent:this};if(this.options.swaggerOptions){for(var j in this.options.swaggerOptions){a[j]=this.options.swaggerOptions[j]}}var f;for(f=0;f<this.model.parameters.length;f++){var c=this.model.parameters[f];if(c.jsonEditor&&c.jsonEditor.isEnabled()){var k=c.jsonEditor.getValue();b[c.name]=JSON.stringify(k)}}a.responseContentType=$("div select[name=responseContentType]",$(this.el)).val();a.requestContentType=$("div select[name=parameterContentType]",$(this.el)).val();$(".response_throbber",$(this.el)).show();if(g){$(".request_url",$(this.el)).html("<pre></pre>");$(".request_url pre",$(this.el)).text(this.invocationUrl);a.useJQuery=true;b.parameterContentType="multipart/form-data";this.map=b;return this.model.execute(b,a,this.showCompleteStatus,this.showErrorStatus,this)}else{this.map=b;return this.model.execute(b,a,this.showCompleteStatus,this.showErrorStatus,this)}}},getInputMap:function(b){var a,q,g,p,c,k,f,i,e,j,d,h;a={};q=b.find("input");for(g=0,p=q.length;g<p;g++){c=q[g];if((c.value!==null)&&jQuery.trim(c.value).length>0){a[c.name]=c.value}if(c.type==="file"){a[c.name]=c.files[0]}}k=b.find("textarea");for(f=0,i=k.length;f<i;f++){c=k[f];e=this.getTextAreaValue(c);if((e!==null)&&jQuery.trim(e).length>0){a[c.name]=e}}j=b.find("select");for(d=0,h=j.length;d<h;d++){c=j[d];e=this.getSelectedValue(c);if((e!==null)&&jQuery.trim(e).length>0){a[c.name]=e}}return a},isFileUpload:function(e){var d,c,a,f;var b=false;d=e.find("input");for(c=0,a=d.length;c<a;c++){f=d[c];if(f.type==="file"){b=true}}return b},success:function(a,b){b.showCompleteStatus(a)},wrap:function(e){var d,f,j,c,b,a,g;j={};f=e.getAllResponseHeaders().split("\r");for(b=0,a=f.length;b<a;b++){c=f[b];d=c.match(/^([^:]*?):(.*)$/);if(!d){d=[]}d.shift();if(d[0]!==void 0&&d[1]!==void 0){j[d[0].trim()]=d[1].trim()}}g={};g.content={};g.content.data=e.responseText;g.headers=j;g.request={};g.request.url=this.invocationUrl;g.status=e.status;return g},getSelectedValue:function(b){if(!b.multiple){return b.value}else{var d=[];for(var c=0,a=b.options.length;c<a;c++){var e=b.options[c];if(e.selected){d.push(e.value)}}if(d.length>0){return d}else{return null}}},hideResponse:function(a){if(a){a.preventDefault()}$(".response",$(this.el)).slideUp();$(".response_hider",$(this.el)).fadeOut()},showResponse:function(a){var b=JSON.stringify(a,null,"\t").replace(/\n/g,"<br>");$(".response_body",$(this.el)).html(_.escape(b))},showErrorStatus:function(b,a){a.showStatus(b)},showCompleteStatus:function(b,a){a.showStatus(b)},formatXml:function(g){var d,k,f,b,e,h,i,o,j,c,a,m,n;a=/(>)(<)(\/*)/g;n=/[ ]*(.*)[ ]+\n/g;d=/(<.+>)(.+\n)/g;g=g.replace(/\r\n/g,"\n").replace(a,"$1\n$2$3").replace(n,"$1\n").replace(d,"$1\n$2");c=0;f="";o=g.split("\n");b=0;h="other";m={"single->single":0,"single->closing":-1,"single->opening":0,"single->other":0,"closing->single":0,"closing->closing":-1,"closing->opening":0,"closing->other":0,"opening->single":1,"opening->closing":0,"opening->opening":1,"opening->other":1,"other->single":0,"other->closing":-1,"other->opening":0,"other->other":0};k=function(t){var p,l,r,v,s,q,u;q={single:Boolean(t.match(/<.+\/>/)),closing:Boolean(t.match(/<\/.+>/)),opening:Boolean(t.match(/<[^!?].*>/))};s=((function(){var w;w=[];for(r in q){u=q[r];if(u){w.push(r)}}return w})())[0];s=s===void 0?"other":s;p=h+"->"+s;h=s;v="";b+=m[p];v=((function(){var w,x,y;y=[];for(l=w=0,x=b;0<=x?w<x:w>x;l=0<=x?++w:--w){y.push("  ")}return y})()).join("");if(p==="opening->closing"){f=f.substr(0,f.length-1)+t+"\n"}else{f+=v+t+"\n"}};for(e=0,i=o.length;e<i;e++){j=o[e];k(j)}return f},showStatus:function(c){var j,p;if(c.content===undefined){p=c.data;j=c.url}else{p=c.content.data;j=c.request.url}var g=c.headers;p=jQuery.trim(p);var t=null;if(g){t=g["Content-Type"]||g["content-type"];if(t){t=t.split(";")[0].trim()}}$(".response_body",$(this.el)).removeClass("json");$(".response_body",$(this.el)).removeClass("xml");var v=function(A){var a=document.createElement("audio");return !!(a.canPlayType&&a.canPlayType(A).replace(/no/,""))};var n;var d;if(!p){d=$("<code />").text("no content");n=$('<pre class="json" />').append(d)}else{if(t==="application/json"||/\+json$/.test(t)){var u=null;try{u=JSON.stringify(JSON.parse(p),null,"  ")}catch(k){u="can't parse JSON.  Raw result:\n\n"+p}d=$("<code />").text(u);n=$('<pre class="json" />').append(d)}else{if(t==="application/xml"||/\+xml$/.test(t)){d=$("<code />").text(this.formatXml(p));n=$('<pre class="xml" />').append(d)}else{if(t==="text/html"){d=$("<code />").html(_.escape(p));n=$('<pre class="xml" />').append(d)}else{if(/text\/plain/.test(t)){d=$("<code />").text(p);n=$('<pre class="plain" />').append(d)}else{if(/^image\//.test(t)){n=$("<img>").attr("src",j)}else{if(/^audio\//.test(t)&&v(t)){n=$("<audio controls>").append($("<source>").attr("src",j).attr("type",t))}else{if(g["Content-Disposition"]&&(/attachment/).test(g["Content-Disposition"])||g["content-disposition"]&&(/attachment/).test(g["content-disposition"])||g["Content-Description"]&&(/File Transfer/).test(g["Content-Description"])||g["content-description"]&&(/File Transfer/).test(g["content-description"])){if("Blob" in window){var i=t||"text/html";var e=new Blob([p],{type:i});var x=document.createElement("a");var r=window.URL.createObjectURL(e);var y=c.url.substr(c.url.lastIndexOf("/")+1);var h=[i,y,r].join(":");var b=g["content-disposition"]||g["Content-Disposition"];if(typeof b!=="undefined"){var l=/filename=([^;]*);?/.exec(b);if(l!==null&&l.length>1){h=l[1]}}x.setAttribute("href",r);x.setAttribute("download",h);x.innerText="Download "+y;n=$("<div/>").append(x)}else{n=$('<pre class="json" />').append("Download headers detected but your browser does not support downloading binary via XHR (Blob).")}}else{if(g.location||g.Location){window.location=c.url}else{d=$("<code />").text(p);n=$('<pre class="json" />').append(d)}}}}}}}}}var s=n;$(".request_url",$(this.el)).html("<pre></pre>");$(".request_url pre",$(this.el)).text(j);$(".response_code",$(this.el)).html("<pre>"+c.status+"</pre>");$(".response_body",$(this.el)).html(s);$(".response_headers",$(this.el)).html("<pre>"+_.escape(JSON.stringify(c.headers,null,"  ")).replace(/\n/g,"<br>")+"</pre>");$(".response",$(this.el)).slideDown();$(".response_hider",$(this.el)).show();$(".response_throbber",$(this.el)).hide();var z=this.model.asCurl(this.map,{responseContentType:t});z=z.replace("!","&#33;");$("div.curl",$(this.el)).html("<pre>"+_.escape(z)+"</pre>");var m=this.options.swaggerOptions;if(m.showRequestHeaders){var f=$(".sandbox",$(this.el)),w=this.getInputMap(f),o=this.model.getHeaderParams(w);delete o["Content-Type"];$(".request_headers",$(this.el)).html("<pre>"+_.escape(JSON.stringify(o,null,"  ")).replace(/\n/g,"<br>")+"</pre>")}var q=$(".response_body",$(this.el))[0];if(m.highlightSizeThreshold&&typeof c.data!=="undefined"&&c.data.length>m.highlightSizeThreshold){return q}else{return hljs.highlightBlock(q)}},toggleOperationContent:function(b){var a=$("#"+Docs.escapeResourceName(this.parentId+"_"+this.nickname+"_content"));if(a.is(":visible")){$.bbq.pushState("#/",2);b.preventDefault();Docs.collapseOperation(a)}else{Docs.expandOperation(a)}},getTextAreaValue:function(e){var d,b,a,c;if(e.value===null||jQuery.trim(e.value).length===0){return null}d=this.getParamByName(e.name);if(d&&d.type&&d.type.toLowerCase()==="array"){b=e.value.split("\n");a=[];for(c=0;c<b.length;c++){if(b[c]!==null&&jQuery.trim(b[c]).length>0){a.push(b[c])}}return a.length>0?a:null}else{return e.value}},showSnippet:function(){var b=this.$("[name=responseContentType]");var a=this.$(".operation-status .snippet_xml, .response-class .snippet_xml");var c=this.$(".operation-status .snippet_json, .response-class .snippet_json");var d;if(!b.length){return}d=b.val();if(d.indexOf("xml")>-1){a.show();c.hide()}else{c.show();a.hide()}},getParamByName:function(a){var b;if(this.model.parameters){for(b=0;b<this.model.parameters.length;b++){if(this.model.parameters[b].name===a){return this.model.parameters[b]}}}return null}});