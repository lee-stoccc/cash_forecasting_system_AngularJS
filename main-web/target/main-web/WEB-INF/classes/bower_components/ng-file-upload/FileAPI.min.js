/*! 12.0.4 */
/*! FileAPI 2.0.7 - BSD | git://github.com/mailru/FileAPI.git
 * FileAPI â€” a set of  javascript tools for working with files. Multiupload, drag'n'drop and chunked file upload. Images: crop, resize and auto orientation by EXIF.
 */
!function(h){var g=h.HTMLCanvasElement&&h.HTMLCanvasElement.prototype,l=h.Blob&&function(){try{return Boolean(new Blob)}catch(b){return !1}}(),k=l&&h.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(b){return !1}}(),j=h.BlobBuilder||h.WebKitBlobBuilder||h.MozBlobBuilder||h.MSBlobBuilder,i=(l||j)&&h.atob&&h.ArrayBuffer&&h.Uint8Array&&function(d){var c,p,o,n,m,e;for(c=d.split(",")[0].indexOf("base64")>=0?atob(d.split(",")[1]):decodeURIComponent(d.split(",")[1]),p=new ArrayBuffer(c.length),o=new Uint8Array(p),n=0;n<c.length;n+=1){o[n]=c.charCodeAt(n)}return m=d.split(",")[0].split(":")[1].split(";")[0],l?new Blob([k?o:p],{type:m}):(e=new j,e.append(p),e.getBlob(m))};h.HTMLCanvasElement&&!g.toBlob&&(g.mozGetAsFile?g.toBlob=function(b,f,e){b(e&&g.toDataURL&&i?i(this.toDataURL(f,e)):this.mozGetAsFile("blob",f))}:g.toDataURL&&i&&(g.toBlob=function(e,d,f){e(i(this.toDataURL(d,f)))})),h.dataURLtoBlob=i}(window),function(a0,aZ){function aY(h,g,l,k,j){var i={type:l.type||l,target:h,result:k};ah(i,j),g(i)}function aX(b){return aG&&!!aG.prototype["readAs"+b]}function aW(b,n,m,l){if(ab.isBlob(b)&&aX(m)){var k=new aG;ag(k,an,function c(a){var e=a.type;"progress"==e?aY(b,n,a,a.target.result,{loaded:a.loaded,total:a.total}):"loadend"==e?(af(k,an,c),k=null):aY(b,n,a,a.target.result)});try{l?k["readAs"+m](b,l):k["readAs"+m](b)}catch(d){aY(b,n,"error",aZ,{error:d.toString()})}}else{aY(b,n,"error",aZ,{error:"FileReader_not_support_"+m})}}function aV(f,e){if(!f.type&&f.size%4096===0&&f.size<=102400){if(aG){try{var h=new aG;ae(h,an,function(b){var c="error"!=b.type;e(c),c&&h.abort()}),h.readAsDataURL(f)}catch(g){e(!1)}}else{e(null)}}else{e(!0)}}function aU(d){var c;return d.getAsEntry?c=d.getAsEntry():d.webkitGetAsEntry&&(c=d.webkitGetAsEntry()),c}function aT(f,e){if(f){if(f.isFile){f.file(function(a){a.fullPath=f.fullPath,e(!1,[a])},function(b){e("FileError.code: "+b.code)})}else{if(f.isDirectory){var h=f.createReader(),g=[];h.readEntries(function(b){ab.afor(b,function(d,i){aT(i,function(j,a){j?ab.log(j):g=g.concat(a),d?d():e(!1,g)})})},function(b){e("directory_reader: "+b)})}else{aT(aU(f),e)}}}else{e("invalid entry")}}function aS(d){var c={};return ai(d,function(b,e){b&&"object"==typeof b&&void 0===b.nodeType&&(b=ah({},b)),c[e]=b}),c}function aR(b){return av.test(b&&b.tagName)}function aQ(b){return(b.originalEvent||b||"").dataTransfer||{}}function aP(d){var c;for(c in d){if(d.hasOwnProperty(c)&&!(d[c] instanceof Object||"overlay"===c||"filter"===c)){return !0}}return !1}var aO=1,aN=function(){},aM=a0.document,aL=aM.doctype||{},aK=a0.navigator.userAgent,aJ=a0.createObjectURL&&a0||a0.URL&&URL.revokeObjectURL&&URL||a0.webkitURL&&webkitURL,aI=a0.Blob,aH=a0.File,aG=a0.FileReader,aF=a0.FormData,aE=a0.XMLHttpRequest,aD=a0.jQuery,aC=!(!(aH&&aG&&(a0.Uint8Array||aF||aE.prototype.sendAsBinary))||/safari\//i.test(aK)&&!/chrome\//i.test(aK)&&/windows/i.test(aK)),aB=aC&&"withCredentials" in new aE,aA=aC&&!!aI&&!!(aI.prototype.webkitSlice||aI.prototype.mozSlice||aI.prototype.slice),az=a0.dataURLtoBlob,ay=/img/i,ax=/canvas/i,aw=/img|canvas/i,av=/input/i,au=/^data:[^,]+,/,at={}.toString,ar=a0.Math,aq=function(a){return a=new a0.Number(ar.pow(1024,a)),a.from=function(b){return ar.round(b*this)},a},ap={},ao=[],an="abort progress error load loadend",am="status statusText readyState response responseXML responseText responseBody".split(" "),al="currentTarget",ak="preventDefault",aj=function(b){return b&&"length" in b},ai=function(h,g,l){if(h){if(aj(h)){for(var k=0,j=h.length;j>k;k++){k in h&&g.call(l,h[k],k,h)}}else{for(var i in h){h.hasOwnProperty(i)&&g.call(l,h[i],i,h)}}}},ah=function(f){for(var e=arguments,h=1,g=function(a,d){f[d]=a};h<e.length;h++){ai(e[h],g)}return f},ag=function(g,f,j){if(g){var i=ab.uid(g);ap[i]||(ap[i]={});var h=aG&&g&&g instanceof aG;ai(f.split(/\s+/),function(a){aD&&!h?aD.event.add(g,a,j):(ap[i][a]||(ap[i][a]=[]),ap[i][a].push(j),g.addEventListener?g.addEventListener(a,j,!1):g.attachEvent?g.attachEvent("on"+a,j):g["on"+a]=j)})}},af=function(h,g,l){if(h){var k=ab.uid(h),j=ap[k]||{},i=aG&&h&&h instanceof aG;ai(g.split(/\s+/),function(a){if(aD&&!i){aD.event.remove(h,a,l)}else{for(var e=j[a]||[],c=e.length;c--;){if(e[c]===l){e.splice(c,1);break}}h.addEventListener?h.removeEventListener(a,l,!1):h.detachEvent?h.detachEvent("on"+a,l):h["on"+a]=null}})}},ae=function(f,e,h){ag(f,e,function g(a){af(f,e,g),h(a)})},ad=function(a){return a.target||(a.target=a0.event&&a0.event.srcElement||aM),3===a.target.nodeType&&(a.target=a.target.parentNode),a},ac=function(d){var c=aM.createElement("input");return c.setAttribute("type","file"),d in c},ab={version:"2.0.7",cors:!1,html5:!0,media:!1,formData:!0,multiPassResize:!0,debug:!1,pingUrl:!1,multiFlash:!1,flashAbortTimeout:0,withCredentials:!0,staticPath:"./dist/",flashUrl:0,flashImageUrl:0,postNameConcat:function(d,c){return d+(null!=c?"["+c+"]":"")},ext2mime:{jpg:"image/jpeg",tif:"image/tiff",txt:"text/plain"},accept:{"image/*":"art bm bmp dwg dxf cbr cbz fif fpx gif ico iefs jfif jpe jpeg jpg jps jut mcf nap nif pbm pcx pgm pict pm png pnm qif qtif ras rast rf rp svf tga tif tiff xbm xbm xpm xwd","audio/*":"m4a flac aac rm mpa wav wma ogg mp3 mp2 m3u mod amf dmf dsm far gdm imf it m15 med okt s3m stm sfx ult uni xm sid ac3 dts cue aif aiff wpl ape mac mpc mpp shn wv nsf spc gym adplug adx dsp adp ymf ast afc hps xs","video/*":"m4v 3gp nsv ts ty strm rm rmvb m3u ifo mov qt divx xvid bivx vob nrg img iso pva wmv asf asx ogm m2v avi bin dat dvr-ms mpg mpeg mp4 mkv avc vp3 svq3 nuv viv dv fli flv wpl"},uploadRetry:0,networkDownRetryTimeout:5000,chunkSize:0,chunkUploadRetry:0,chunkNetworkDownRetryTimeout:2000,KB:aq(1),MB:aq(2),GB:aq(3),TB:aq(4),EMPTY_PNG:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQIW2NkAAIAAAoAAggA9GkAAAAASUVORK5CYII=",expando:"fileapi"+(new Date).getTime(),uid:function(b){return b?b[ab.expando]=b[ab.expando]||ab.uid():(++aO,ab.expando+aO)},log:function(){ab.debug&&ab._supportConsoleLog&&(ab._supportConsoleLogApply?console.log.apply(console,arguments):console.log([].join.call(arguments," ")))},newImage:function(e,d){var f=aM.createElement("img");return d&&ab.event.one(f,"error load",function(b){d("error"==b.type,f),f=null}),f.src=e,f},getXHR:function(){var a;if(aE){a=new aE}else{if(a0.ActiveXObject){try{a=new ActiveXObject("MSXML2.XMLHttp.3.0")}catch(d){a=new ActiveXObject("Microsoft.XMLHTTP")}}}return a},isArray:aj,support:{dnd:aB&&"ondrop" in aM.createElement("div"),cors:aB,html5:aC,chunked:aA,dataURI:!0,accept:ac("accept"),multiple:ac("multiple")},event:{on:ag,off:af,one:ae,fix:ad},throttle:function(a,h){var g,f;return function(){f=arguments,g||(a.apply(a0,f),g=setTimeout(function(){g=0,a.apply(a0,f)},h))}},F:function(){},parseJSON:function(a){var d;return d=a0.JSON&&JSON.parse?JSON.parse(a):new Function("return ("+a.replace(/([\r\n])/g,"\\$1")+");")()},trim:function(b){return b=String(b),b.trim?b.trim():b.replace(/^\s+|\s+$/g,"")},defer:function(){var b,h,g=[],f={resolve:function(a,c){for(f.resolve=aN,h=a||!1,b=c;c=g.shift();){c(h,b)}},then:function(a){h!==aZ?a(h,b):g.push(a)}};return f},queue:function(h){var g=0,l=0,k=!1,j=!1,i={inc:function(){l++},next:function(){g++,setTimeout(i.check,0)},check:function(){g>=l&&!k&&i.end()},isFail:function(){return k},fail:function(){!k&&h(k=!0)},end:function(){j||(j=!0,h())}};return i},each:ai,afor:function(g,f){var j=0,i=g.length;aj(g)&&i--?!function h(){f(i!=j&&h,g[j],j++)}():f(!1)},extend:ah,isFile:function(b){return"[object File]"===at.call(b)},isBlob:function(b){return this.isFile(b)||"[object Blob]"===at.call(b)},isCanvas:function(b){return b&&ax.test(b.nodeName)},getFilesFilter:function(b){return b="string"==typeof b?b:b.getAttribute&&b.getAttribute("accept")||"",b?new RegExp("("+b.replace(/\./g,"\\.").replace(/,/g,"|")+")$","i"):/./},readAsDataURL:function(d,c){ab.isCanvas(d)?aY(d,c,"load",ab.toDataURL(d)):aW(d,c,"DataURL")},readAsBinaryString:function(d,c){aX("BinaryString")?aW(d,c,"BinaryString"):aW(d,function(b){if("load"==b.type){try{b.result=ab.toBinaryString(b.result)}catch(e){b.type="error",b.message=e.toString()}}c(b)},"DataURL")},readAsArrayBuffer:function(d,c){aW(d,c,"ArrayBuffer")},readAsText:function(e,d,f){f||(f=d,d="utf-8"),aW(e,f,"Text",d)},toDataURL:function(d,c){return"string"==typeof d?d:d.toDataURL?d.toDataURL(c||"image/png"):void 0},toBinaryString:function(a){return a0.atob(ab.toDataURL(a).replace(au,""))},readAsImage:function(b,n,m){if(ab.isFile(b)){if(aJ){var l=aJ.createObjectURL(b);l===aZ?aY(b,n,"error"):ab.readAsImage(l,n,m)}else{ab.readAsDataURL(b,function(a){"load"==a.type?ab.readAsImage(a.result,n,m):(m||"error"==a.type)&&aY(b,n,a,null,{loaded:a.loaded,total:a.total})})}}else{if(ab.isCanvas(b)){aY(b,n,"load",b)}else{if(ay.test(b.nodeName)){if(b.complete){aY(b,n,"load",b)}else{var k="error abort load";ae(b,k,function c(a){"load"==a.type&&aJ&&aJ.revokeObjectURL(b.src),af(b,k,c),aY(b,n,a,b)})}}else{if(b.iframe){aY(b,n,{type:"error"})}else{var j=ab.newImage(b.dataURL||b);ab.readAsImage(j,n,m)}}}}},checkFileObj:function(e){var d={},f=ab.accept;return"object"==typeof e?d=e:d.name=(e+"").split(/\\|\//g).pop(),null==d.type&&(d.type=d.name.split(".").pop()),ai(f,function(b,g){b=new RegExp(b.replace(/\s/g,"|"),"i"),(b.test(d.type)||ab.ext2mime[d.type])&&(d.type=ab.ext2mime[d.type]||g.split("/")[0]+"/"+d.type)}),d},getDropFiles:function(g,f){var l=[],k=aQ(g),j=aj(k.items)&&k.items[0]&&aU(k.items[0]),h=ab.queue(function(){f(l)});ai((j?k.items:k.files)||[],function(d){h.inc();try{j?aT(d,function(i,e){i?ab.log("[err] getDropFiles:",i):l.push.apply(l,e),h.next()}):aV(d,function(a){a&&l.push(d),h.next()})}catch(c){h.next(),ab.log("[err] getDropFiles: ",c)}}),h.check()},getFiles:function(f,e,h){var g=[];return h?(ab.filterFiles(ab.getFiles(f),e,h),null):(f.jquery&&(f.each(function(){g=g.concat(ab.getFiles(this))}),f=g,g=[]),"string"==typeof e&&(e=ab.getFilesFilter(e)),f.originalEvent?f=ad(f.originalEvent):f.srcElement&&(f=ad(f)),f.dataTransfer?f=f.dataTransfer:f.target&&(f=f.target),f.files?(g=f.files,aC||(g[0].blob=f,g[0].iframe=!0)):!aC&&aR(f)?ab.trim(f.value)&&(g=[ab.checkFileObj(f.value)],g[0].blob=f,g[0].iframe=!0):aj(f)&&(g=f),ab.filter(g,function(b){return !e||e.test(b.name)}))},getTotalSize:function(e){for(var d=0,f=e&&e.length;f--;){d+=e[f].size}return d},getInfo:function(g,f){var j={},i=ao.concat();ab.isFile(g)?!function h(){var a=i.shift();a?a.test(g.type)?a(g,function(b,c){b?f(b):(ah(j,c),h())}):h():f(!1,j)}():f("not_support_info",j)},addInfoReader:function(d,c){c.test=function(a){return d.test(a)},ao.push(c)},filter:function(h,g){for(var l,k=[],j=0,i=h.length;i>j;j++){j in h&&(l=h[j],g.call(l,l,j,h)&&k.push(l))}return k},filterFiles:function(j,i,p){if(j.length){var o,n=j.concat(),m=[],l=[];!function k(){n.length?(o=n.shift(),ab.getInfo(o,function(b,d){(i(o,b?!1:d)?m:l).push(o),k()})):p(m,l)}()}else{p([],j)}},upload:function(j){j=ah({jsonp:"callback",prepare:ab.F,beforeupload:ab.F,upload:ab.F,fileupload:ab.F,fileprogress:ab.F,filecomplete:ab.F,progress:ab.F,complete:ab.F,pause:ab.F,imageOriginal:!0,chunkSize:ab.chunkSize,chunkUploadRetry:ab.chunkUploadRetry,uploadRetry:ab.uploadRetry},j),j.imageAutoOrientation&&!j.imageTransform&&(j.imageTransform={rotate:"auto"});var i,p=new ab.XHR(j),o=this._getFilesDataArray(j.files),n=this,m=0,l=0,k=!1;return ai(o,function(b){m+=b.size}),p.files=[],ai(o,function(b){p.files.push(b.file)}),p.total=m,p.loaded=0,p.filesLeft=o.length,j.beforeupload(p,j),i=function(){var d=o.shift(),c=d&&d.file,b=!1,a=aS(j);if(p.filesLeft=o.length,c&&c.name===ab.expando&&(c=null,ab.log("[warn] FileAPI.upload() â€” called without files")),("abort"!=p.statusText||p.current)&&d){if(k=!1,p.currentFile=c,c&&j.prepare(c,a)===!1){return void i.call(n)}a.file=c,n._getFormData(a,d,function(g){l||j.upload(p,j);var f=new ab.XHR(ah({},a,{upload:c?function(){j.fileupload(c,f,a)}:aN,progress:c?function(h){b||(b=h.loaded===h.total,j.fileprogress({type:"progress",total:d.total=h.total,loaded:d.loaded=h.loaded},c,f,a),j.progress({type:"progress",total:m,loaded:p.loaded=l+d.size*(h.loaded/h.total)|0},c,f,a))}:aN,complete:function(h){ai(am,function(q){p[q]=f[q]}),c&&(d.total=d.total||d.size,d.loaded=d.total,h||(this.progress(d),b=!0,l+=d.size,p.loaded=l),j.filecomplete(h,f,c,a)),setTimeout(function(){i.call(n)},0)}}));p.abort=function(h){h||(o.length=0),this.current=h,f.abort()},f.send(g)})}else{var e=200==p.status||201==p.status||204==p.status;j.complete(e?!1:p.statusText||"error",p,j),k=!0}},setTimeout(i,0),p.append=function(b,c){b=ab._getFilesDataArray([].concat(b)),ai(b,function(d){m+=d.size,p.files.push(d.file),c?o.unshift(d):o.push(d)}),p.statusText="",k&&i.call(n)},p.remove=function(e){for(var d,f=o.length;f--;){o[f].file==e&&(d=o.splice(f,1),m-=d.size)}return d},p},_getFilesDataArray:function(g){var f=[],j={};if(aR(g)){var i=ab.getFiles(g);j[g.name||"file"]=null!==g.getAttribute("multiple")?i:i[0]}else{aj(g)&&aR(g[0])?ai(g,function(b){j[b.name||"file"]=ab.getFiles(b)}):j=g}return ai(j,function h(b,d){aj(b)?ai(b,function(c){h(c,d)}):b&&(b.name||b.image)&&f.push({name:d,file:b,size:b.size,total:b.size,loaded:0})}),f.length||f.push({file:{name:ab.expando}}),f},_getFormData:function(B,A,z){var y=A.file,x=A.name,w=y.name,v=y.type,u=ab.support.transform&&B.imageTransform,t=new ab.Form,s=ab.queue(function(){z(t)}),r=u&&aP(u),q=ab.postNameConcat;ai(B.data,function p(d,c){"object"==typeof d?ai(d,function(b,e){p(b,q(c,e))}):t.append(c,d)}),function l(a){a.image?(s.inc(),a.toData(function(d,c){w=w||(new Date).getTime()+".png",l(c),s.next()})):ab.Image&&u&&(/^image/.test(a.type)||aw.test(a.nodeName))?(s.inc(),r&&(u=[u]),ab.Image.transform(a,u,B.imageAutoOrientation,function(f,e){if(r&&!f){az||ab.flashEngine||(t.multipart=!0),t.append(x,e[0],w,u[0].type||v)}else{var b=0;f||ai(e,function(d,c){az||ab.flashEngine||(t.multipart=!0),u[c].postName||(b=1),t.append(u[c].postName||q(x,c),d,w,u[c].type||v)}),(f||B.imageOriginal)&&t.append(q(x,b?"original":null),a,w,v)}s.next()})):w!==ab.expando&&t.append(x,a,w)}(y),s.check()},reset:function(f,e){var h,g;return aD?(g=aD(f).clone(!0).insertBefore(f).val("")[0],e||aD(f).remove()):(h=f.parentNode,g=h.insertBefore(f.cloneNode(!0),f),g.value="",e||h.removeChild(f),ai(ap[ab.uid(f)],function(a,d){ai(a,function(c){af(f,d,c),ag(g,d,c)})})),g},load:function(e,d){var f=ab.getXHR();return f?(f.open("GET",e,!0),f.overrideMimeType&&f.overrideMimeType("text/plain; charset=x-user-defined"),ag(f,"progress",function(b){b.lengthComputable&&d({type:b.type,loaded:b.loaded,total:b.total},f)}),f.onreadystatechange=function(){if(4==f.readyState){if(f.onreadystatechange=null,200==f.status){e=e.split("/");var a={name:e[e.length-1],size:f.getResponseHeader("Content-Length"),type:f.getResponseHeader("Content-Type")};a.dataURL="data:"+a.type+";base64,"+ab.encode64(f.responseBody||f.responseText),d({type:"load",result:a},f)}else{d({type:"error"},f)}}},f.send(null)):d({type:"error"}),f},encode64:function(v){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t="",s=0;for("string"!=typeof v&&(v=String(v));s<v.length;){var r,q,p=255&v.charCodeAt(s++),o=255&v.charCodeAt(s++),n=255&v.charCodeAt(s++),m=p>>2,l=(3&p)<<4|o>>4;isNaN(o)?r=q=64:(r=(15&o)<<2|n>>6,q=isNaN(n)?64:63&n),t+=u.charAt(m)+u.charAt(l)+u.charAt(r)+u.charAt(q)}return t}};ab.addInfoReader(/^image/,function(e,d){if(!e.__dimensions){var f=e.__dimensions=ab.defer();ab.readAsImage(e,function(g){var c=g.target;f.resolve("load"==g.type?!1:"error",{width:c.width,height:c.height}),c.src=ab.EMPTY_PNG,c=null})}e.__dimensions.then(d)}),ab.event.dnd=function(g,f,j){var i,h;j||(j=f,f=ab.F),aG?(ag(g,"dragenter dragleave dragover",f.ff=f.ff||function(b){for(var k=aQ(b).types,e=k&&k.length,d=!1;e--;){if(~k[e].indexOf("File")){b[ak](),h!==b.type&&(h=b.type,"dragleave"!=h&&f.call(b[al],!0,b),d=!0);break}}d&&(clearTimeout(i),i=setTimeout(function(){f.call(b[al],"dragleave"!=h,b)},50))}),ag(g,"drop",j.ff=j.ff||function(b){b[ak](),h=0,f.call(b[al],!1,b),ab.getDropFiles(b,function(a){j.call(b[al],a,b)})})):ab.log("Drag'n'Drop -- not supported")},ab.event.dnd.off=function(e,d,f){af(e,"dragenter dragleave dragover",d.ff),af(e,"drop",f.ff)},aD&&!aD.fn.dnd&&(aD.fn.dnd=function(d,c){return this.each(function(){ab.event.dnd(this,d,c)})},aD.fn.offdnd=function(d,c){return this.each(function(){ab.event.dnd.off(this,d,c)})}),a0.FileAPI=ah(ab,a0.FileAPI),ab.log("FileAPI: "+ab.version),ab.log("protocol: "+a0.location.protocol),ab.log("doctype: ["+aL.name+"] "+aL.publicId+" "+aL.systemId),ai(aM.getElementsByTagName("meta"),function(b){/x-ua-compatible/i.test(b.getAttribute("http-equiv"))&&ab.log("meta.http-equiv: "+b.getAttribute("content"))});try{ab._supportConsoleLog=!!console.log,ab._supportConsoleLogApply=!!console.log.apply}catch(aa){}ab.flashUrl||(ab.flashUrl=ab.staticPath+"FileAPI.flash.swf"),ab.flashImageUrl||(ab.flashImageUrl=ab.staticPath+"FileAPI.flash.image.swf"),ab.flashWebcamUrl||(ab.flashWebcamUrl=ab.staticPath+"FileAPI.flash.camera.swf")}(window,void 0),function(t,s,r){function q(a){if(a instanceof q){var d=new q(a.file);return t.extend(d.matrix,a.matrix),d}return this instanceof q?(this.file=a,this.size=a.size||100,void (this.matrix={sx:0,sy:0,sw:0,sh:0,dx:0,dy:0,dw:0,dh:0,resize:0,deg:0,quality:1,filter:0})):new q(a)}var p=Math.min,o=Math.round,n=function(){return s.createElement("canvas")},m=!1,l={8:270,3:180,6:90,7:270,4:180,5:90};try{m=n().toDataURL("image/png").indexOf("data:image/png")>-1}catch(k){}q.prototype={image:!0,constructor:q,set:function(a){return t.extend(this.matrix,a),this},crop:function(f,c,h,g){return h===r&&(h=f,g=c,f=c=0),this.set({sx:f,sy:c,sw:h,sh:g||h})},resize:function(e,d,f){return/min|max/.test(d)&&(f=d,d=e),this.set({dw:e,dh:d||e,resize:f})},preview:function(d,c){return this.resize(d,c||d,"preview")},rotate:function(b){return this.set({deg:b})},filter:function(b){return this.set({filter:b})},overlay:function(b){return this.set({overlay:b})},clone:function(){return new q(this)},_load:function(a,f){var e=this;/img|video/i.test(a.nodeName)?f.call(e,null,a):t.readAsImage(a,function(b){f.call(e,"load"!=b.type,b.result)})},_apply:function(J,I){var H,G=n(),F=this.getMatrix(J),E=G.getContext("2d"),D=J.videoWidth||J.width,C=J.videoHeight||J.height,B=F.deg,A=F.dw,z=F.dh,y=D,x=C,w=F.filter,g=J,e=F.overlay,d=t.queue(function(){J.src=t.EMPTY_PNG,I(!1,G)}),a=t.renderImageToCanvas;for(B-=360*Math.floor(B/360),J._type=this.file.type;F.multipass&&p(y/A,x/z)>2;){y=y/2+0.5|0,x=x/2+0.5|0,H=n(),H.width=y,H.height=x,g!==J?(a(H,g,0,0,g.width,g.height,0,0,y,x),g=H):(g=H,a(g,J,F.sx,F.sy,F.sw,F.sh,0,0,y,x),F.sx=F.sy=F.sw=F.sh=0)}G.width=B%180?z:A,G.height=B%180?A:z,G.type=F.type,G.quality=F.quality,E.rotate(B*Math.PI/180),a(E.canvas,g,F.sx,F.sy,F.sw||g.width,F.sh||g.height,180==B||270==B?-A:0,90==B||180==B?-z:0,A,z),A=G.width,z=G.height,e&&t.each([].concat(e),function(f){d.inc();var i=new window.Image,h=function(){var K=0|f.x,v=0|f.y,u=f.w||i.width,j=f.h||i.height,c=f.rel;K=1==c||4==c||7==c?(A-u+K)/2:2==c||5==c||8==c?A-(u+K):K,v=3==c||4==c||5==c?(z-j+v)/2:c>=6?z-(j+v):v,t.event.off(i,"error load abort",h);try{E.globalAlpha=f.opacity||1,E.drawImage(i,K,v,u,j)}catch(b){}d.next()};t.event.on(i,"error load abort",h),i.src=f.src,i.complete&&h()}),w&&(d.inc(),q.applyFilter(G,w,d.next)),d.check()},getMatrix:function(B){var A=t.extend({},this.matrix),z=A.sw=A.sw||B.videoWidth||B.naturalWidth||B.width,y=A.sh=A.sh||B.videoHeight||B.naturalHeight||B.height,x=A.dw=A.dw||z,w=A.dh=A.dh||y,v=z/y,u=x/w,f=A.resize;if("preview"==f){if(x!=z||w!=y){var e,a;u>=v?(e=z,a=e/u):(a=y,e=a*u),(e!=z||a!=y)&&(A.sx=~~((z-e)/2),A.sy=~~((y-a)/2),z=e,y=a)}}else{f&&(z>x||y>w?"min"==f?(x=o(u>v?p(z,x):w*v),w=o(u>v?x/v:p(y,w))):(x=o(v>=u?p(z,x):w*v),w=o(v>=u?x/v:p(y,w))):(x=z,w=y))}return A.sw=z,A.sh=y,A.dw=x,A.dh=w,A.multipass=t.multiPassResize,A},_trans:function(a){this._load(this.file,function(e,b){if(e){a(e)}else{try{this._apply(b,a)}catch(e){t.log("[err] FileAPI.Image.fn._apply:",e),a(e)}}})},get:function(a){if(t.support.transform){var f=this,e=f.matrix;"auto"==e.deg?t.getInfo(f.file,function(b,c){e.deg=l[c&&c.exif&&c.exif.Orientation]||0,f._trans(a)}):f._trans(a)}else{a("not_support_transform")}return this},toData:function(b){return this.get(b)}},q.exifOrientation=l,q.transform=function(a,j,i,d){function c(g,f){var e={},b=t.queue(function(h){d(h,e)});g?b.fail():t.each(j,function(v,y){if(!b.isFail()){var x=new q(f.nodeType?f:a),w="function"==typeof v;if(w?v(f,x):v.width?x[v.preview?"preview":"resize"](v.width,v.height,v.strategy):v.maxWidth&&(f.width>v.maxWidth||f.height>v.maxHeight)&&x.resize(v.maxWidth,v.maxHeight,"max"),v.crop){var u=v.crop;x.crop(0|u.x,0|u.y,u.w||u.width,u.h||u.height)}v.rotate===r&&i&&(v.rotate="auto"),x.set({type:x.matrix.type||v.type||a.type||"image/png"}),w||x.set({deg:v.rotate,overlay:v.overlay,filter:v.filter,quality:v.quality||1}),b.inc(),x.toData(function(z,h){z?b.fail():(e[y]=h,b.next())})}})}a.width?c(!1,a):t.getInfo(a,c)},t.each(["TOP","CENTER","BOTTOM"],function(a,d){t.each(["LEFT","CENTER","RIGHT"],function(b,c){q[a+"_"+b]=3*d+c,q[b+"_"+a]=3*d+c})}),q.toCanvas=function(b){var d=s.createElement("canvas");return d.width=b.videoWidth||b.width,d.height=b.videoHeight||b.height,d.getContext("2d").drawImage(b,0,0),d},q.fromDataURL=function(a,h,g){var f=t.newImage(a);t.extend(f,h),g(f)},q.applyFilter=function(a,f,d){"function"==typeof f?f(a,d):window.Caman&&window.Caman("IMG"==a.tagName?q.toCanvas(a):a,function(){"string"==typeof f?this[f]():t.each(f,function(e,c){this[c](e)},this),this.render(d)})},t.renderImageToCanvas=function(D,C,B,A,z,y,x,w,v,u){try{return D.getContext("2d").drawImage(C,B,A,z,y,x,w,v,u)}catch(a){throw t.log("renderImageToCanvas failed"),a}},t.support.canvas=t.support.transform=m,t.Image=q}(FileAPI,document),function(b){b(FileAPI)}(function(d){if(window.navigator&&window.navigator.platform&&/iP(hone|od|ad)/.test(window.navigator.platform)){var c=d.renderImageToCanvas;d.detectSubsampling=function(f){var e,g;return f.width*f.height>1048576?(e=document.createElement("canvas"),e.width=e.height=1,g=e.getContext("2d"),g.drawImage(f,-f.width+1,0),0===g.getImageData(0,0,1,1).data[3]):!1},d.detectVerticalSquash=function(t,s){var r,q,p,o,n,m=t.naturalHeight||t.height,l=document.createElement("canvas"),k=l.getContext("2d");for(s&&(m/=2),l.width=1,l.height=m,k.drawImage(t,0,0),r=k.getImageData(0,0,1,m).data,q=0,p=m,o=m;o>q;){n=r[4*(o-1)+3],0===n?p=o:q=o,o=p+q>>1}return o/m||1},d.renderImageToCanvas=function(J,I,H,G,F,E,D,C,B,A){if("image/jpeg"===I._type){var z,y,x,w,v=J.getContext("2d"),u=document.createElement("canvas"),b=1024,a=u.getContext("2d");if(u.width=b,u.height=b,v.save(),z=d.detectSubsampling(I),z&&(H/=2,G/=2,F/=2,E/=2),y=d.detectVerticalSquash(I,z),z||1!==y){for(G*=y,B=Math.ceil(b*B/F),A=Math.ceil(b*A/E/y),C=0,w=0;E>w;){for(D=0,x=0;F>x;){a.clearRect(0,0,b,b),a.drawImage(I,H,G,F,E,-x,-w,F,E),v.drawImage(u,0,0,b,b,D,C,B,A),x+=b,D+=B}w+=b,C+=A}return v.restore(),J}}return c(J,I,H,G,F,E,D,C,B,A)}}}),function(i,h){function n(v,u,t){var s=v.blob,r=v.file;if(r){if(!s.toDataURL){return void i.readAsBinaryString(s,function(b){"load"==b.type&&u(v,b.result)})}var q={"image/jpeg":".jpe?g","image/png":".png"},p=q[v.type]?v.type:"image/png",o=q[p]||".png",a=s.quality||1;r.match(new RegExp(o+"$","i"))||(r+=o.replace("?","")),v.file=r,v.type=p,!t&&s.toBlob?s.toBlob(function(b){u(v,b)},p,a):u(v,i.toBinaryString(s.toDataURL(p,a)))}else{u(v,s)}}var m=h.document,l=h.FormData,k=function(){this.items=[]},j=h.encodeURIComponent;k.prototype={append:function(f,e,o,g){this.items.push({name:f,blob:e&&e.blob||(void 0==e?"":e),file:e&&(o||e.name),type:e&&(g||e.type)})},each:function(e){for(var d=0,f=this.items.length;f>d;d++){e.call(this,this.items[d])}},toData:function(a,d){d._chunked=i.support.chunked&&d.chunkSize>0&&1==i.filter(this.items,function(b){return b.file}).length,i.support.html5?i.formData&&!this.multipart&&l?d._chunked?(i.log("FileAPI.Form.toPlainData"),this.toPlainData(a)):(i.log("FileAPI.Form.toFormData"),this.toFormData(a)):(i.log("FileAPI.Form.toMultipartData"),this.toMultipartData(a)):(i.log("FileAPI.Form.toHtmlData"),this.toHtmlData(a))},_to:function(a,q,p,o){var g=i.queue(function(){q(a)});this.each(function(b){p(b,a,g,o)}),g.check()},toHtmlData:function(a){this._to(m.createDocumentFragment(),a,function(d,p){var o,g=d.blob;d.file?(i.reset(g,!0),g.name=d.name,g.disabled=!1,p.appendChild(g)):(o=m.createElement("input"),o.name=d.name,o.type="hidden",o.value=g,p.appendChild(o))})},toPlainData:function(b){this._to({},b,function(e,c,f){e.file&&(c.type=e.file),e.blob.toBlob?(f.inc(),n(e,function(d,g){c.name=d.name,c.file=g,c.size=g.length,c.type=d.type,f.next()})):e.file?(c.name=e.blob.name,c.file=e.blob,c.size=e.blob.size,c.type=e.type):(c.params||(c.params=[]),c.params.push(j(e.name)+"="+j(e.blob))),c.start=-1,c.end=c.file&&c.file.FileAPIReadPosition||-1,c.retry=0})},toFormData:function(b){this._to(new l,b,function(e,c,f){e.blob&&e.blob.toBlob?(f.inc(),n(e,function(d,g){c.append(d.name,g,d.file),f.next()})):e.file?c.append(e.name,e.blob,e.file):c.append(e.name,e.blob),e.file&&c.append("_"+e.name,e.file)})},toMultipartData:function(a){this._to([],a,function(f,c,o,g){o.inc(),n(f,function(b,d){c.push("--_"+g+('\r\nContent-Disposition: form-data; name="'+b.name+'"'+(b.file?'; filename="'+j(b.file)+'"':"")+(b.file?"\r\nContent-Type: "+(b.type||"application/octet-stream"):"")+"\r\n\r\n"+(b.file?d:j(d))+"\r\n")),o.next()},!0)},i.expando)}},i.Form=k}(FileAPI,window),function(h,g){var l=function(){},k=h.document,j=function(b){this.uid=g.uid(),this.xhr={abort:l,getResponseHeader:l,getAllResponseHeaders:l},this.options=b},i={"":1,XML:1,Text:1,Body:1};j.prototype={status:0,statusText:"",constructor:j,getResponseHeader:function(b){return this.xhr.getResponseHeader(b)},getAllResponseHeaders:function(){return this.xhr.getAllResponseHeaders()||{}},end:function(m,c){var b=this,a=b.options;b.end=b.abort=l,b.status=m,c&&(b.statusText=c),g.log("xhr.end:",m,c),a.complete(200==m||201==m?!1:b.statusText||"unknown",b),b.xhr&&b.xhr.node&&setTimeout(function(){var d=b.xhr.node;try{d.parentNode.removeChild(d)}catch(e){}try{delete h[b.uid]}catch(e){}h[b.uid]=b.xhr.node=null},9)},abort:function(){this.end(0,"abort"),this.xhr&&(this.xhr.aborted=!0,this.xhr.abort())},send:function(e){var d=this,f=this.options;e.toData(function(b){f.upload(f,d),d._send.call(d,f,b)},f)},_send:function(D,C){var B,A=this,z=A.uid,y=A.uid+"Load",x=D.url;if(g.log("XHR._send:",C),D.cache||(x+=(~x.indexOf("?")?"&":"?")+g.uid()),C.nodeName){var w=D.jsonp;x=x.replace(/([a-z]+)=(\?)/i,"$1="+z),D.upload(D,A);var v=function(e){if(~x.indexOf(e.origin)){try{var n=g.parseJSON(e.data);n.id==z&&u(n.status,n.statusText,n.response)}catch(m){u(0,m.message)}}},u=h[z]=function(o,n,m){A.readyState=4,A.responseText=m,A.end(o,n),g.event.off(h,"message",v),h[z]=B=d=h[y]=null};A.xhr.abort=function(){try{d.stop?d.stop():d.contentWindow.stop?d.contentWindow.stop():d.contentWindow.document.execCommand("Stop")}catch(c){}u(0,"abort")},g.event.on(h,"message",v),h[y]=function(){try{var m=d.contentWindow,p=m.document,o=m.result||g.parseJSON(p.body.innerHTML);u(o.status,o.statusText,o.response)}catch(n){g.log("[transport.onload]",n)}},B=k.createElement("div"),B.innerHTML='<form target="'+z+'" action="'+x+'" method="POST" enctype="multipart/form-data" style="position: absolute; top: -1000px; overflow: hidden; width: 1px; height: 1px;"><iframe name="'+z+'" src="javascript:false;" onload="'+y+'()"></iframe>'+(w&&D.url.indexOf("=?")<0?'<input value="'+z+'" name="'+w+'" type="hidden"/>':"")+"</form>";var f=B.getElementsByTagName("form")[0],d=B.getElementsByTagName("iframe")[0];f.appendChild(C),g.log(f.parentNode.innerHTML),k.body.appendChild(B),A.xhr.node=B,A.readyState=2,f.submit(),f=null}else{if(x=x.replace(/([a-z]+)=(\?)&?/i,""),this.xhr&&this.xhr.aborted){return void g.log("Error: already aborted")}if(B=A.xhr=g.getXHR(),C.params&&(x+=(x.indexOf("?")<0?"?":"&")+C.params.join("&")),B.open("POST",x,!0),g.withCredentials&&(B.withCredentials="true"),D.headers&&D.headers["X-Requested-With"]||B.setRequestHeader("X-Requested-With","XMLHttpRequest"),g.each(D.headers,function(e,c){B.setRequestHeader(c,e)}),D._chunked){B.upload&&B.upload.addEventListener("progress",g.throttle(function(c){C.retry||D.progress({type:c.type,total:C.size,loaded:C.start+c.loaded,totalSize:C.size},A,D)},100),!1),B.onreadystatechange=function(){var c=parseInt(B.getResponseHeader("X-Last-Known-Byte"),10);if(A.status=B.status,A.statusText=B.statusText,A.readyState=B.readyState,4==B.readyState){try{for(var n in i){A["response"+n]=B["response"+n]}}catch(m){}if(B.onreadystatechange=null,!B.status||B.status-201>0){if(g.log("Error: "+B.status),(!B.status&&!B.aborted||500==B.status||416==B.status)&&++C.retry<=D.chunkUploadRetry){var e=B.status?0:g.chunkNetworkDownRetryTimeout;D.pause(C.file,D),g.log("X-Last-Known-Byte: "+c),c?C.end=c:(C.end=C.start-1,416==B.status&&(C.end=C.end-D.chunkSize)),setTimeout(function(){A._send(D,C)},e)}else{A.end(B.status)}}else{C.retry=0,C.end==C.size-1?A.end(B.status):(g.log("X-Last-Known-Byte: "+c),c&&(C.end=c),C.file.FileAPIReadPosition=C.end,setTimeout(function(){A._send(D,C)},0))}B=null}},C.start=C.end+1,C.end=Math.max(Math.min(C.start+D.chunkSize,C.size)-1,C.start);var b=C.file,a=(b.slice||b.mozSlice||b.webkitSlice).call(b,C.start,C.end+1);C.size&&!a.size?setTimeout(function(){A.end(-1)}):(B.setRequestHeader("Content-Range","bytes "+C.start+"-"+C.end+"/"+C.size),B.setRequestHeader("Content-Disposition","attachment; filename="+encodeURIComponent(C.name)),B.setRequestHeader("Content-Type",C.type||"application/octet-stream"),B.send(a)),b=a=null}else{if(B.upload&&B.upload.addEventListener("progress",g.throttle(function(c){D.progress(c,A,D)},100),!1),B.onreadystatechange=function(){if(A.status=B.status,A.statusText=B.statusText,A.readyState=B.readyState,4==B.readyState){for(var c in i){A["response"+c]=B["response"+c]}if(B.onreadystatechange=null,!B.status||B.status>201){if(g.log("Error: "+B.status),(!B.status&&!B.aborted||500==B.status)&&(D.retry||0)<D.uploadRetry){D.retry=(D.retry||0)+1;var e=g.networkDownRetryTimeout;D.pause(D.file,D),setTimeout(function(){A._send(D,C)},e)}else{A.end(B.status)}}else{A.end(B.status)}B=null}},g.isArray(C)){B.setRequestHeader("Content-Type","multipart/form-data; boundary=_"+g.expando);var F=C.join("")+"--_"+g.expando+"--";if(B.sendAsBinary){B.sendAsBinary(F)}else{var E=Array.prototype.map.call(F,function(c){return 255&c.charCodeAt(0)});B.send(new Uint8Array(E).buffer)}}else{B.send(C)}}}}},g.XHR=j}(window,FileAPI),function(v,u){function t(b){return b>=0?b+"px":b}function s(g){var f,j=q.createElement("canvas"),i=!1;try{f=j.getContext("2d"),f.drawImage(g,0,0,1,1),i=255!=f.getImageData(0,0,1,1).data[4]}catch(h){}return i}var r=v.URL||v.webkitURL,q=v.document,p=v.navigator,o=p.getUserMedia||p.webkitGetUserMedia||p.mozGetUserMedia||p.msGetUserMedia,n=!!o;u.support.media=n;var m=function(b){this.video=b};m.prototype={isActive:function(){return !!this._active},start:function(e){var d,w,k=this,h=k.video,g=function(a){k._active=!a,clearTimeout(w),clearTimeout(d),e&&e(a,k)};o.call(p,{video:!0},function(b){k.stream=b,h.src=r.createObjectURL(b),d=setInterval(function(){s(h)&&g(null)},1000),w=setTimeout(function(){g("timeout")},5000),h.play()},g)},stop:function(){try{this._active=!1,this.video.pause(),this.stream.stop()}catch(b){}},shot:function(){return new l(this.video)}},m.get=function(b){return new m(b.firstChild)},m.publish=function(i,f,c){"function"==typeof f&&(c=f,f={}),f=u.extend({},{width:"100%",height:"100%",start:!0},f),i.jquery&&(i=i[0]);var b=function(e){if(e){c(e)}else{var d=m.get(i);f.start?d.start(c):c(null,d)}};if(i.style.width=t(f.width),i.style.height=t(f.height),u.html5&&n){var a=q.createElement("video");a.style.width=t(f.width),a.style.height=t(f.height),v.jQuery?jQuery(i).empty():i.innerHTML="",i.appendChild(a),b()}else{m.fallback(i,f,b)}},m.fallback=function(e,d,f){f("not_support_camera")};var l=function(b){var f=b.nodeName?u.Image.toCanvas(b):b,e=u.Image(f);return e.type="image/png",e.width=f.width,e.height=f.height,e.size=f.width*f.height*4,e};m.Shot=l,u.Camera=m}(window,FileAPI),function(i,h,n){var m=i.document,l=i.location,k=i.navigator,j=n.each;n.support.flash=function(){var a=k.mimeTypes,e=!1;if(k.plugins&&"object"==typeof k.plugins["Shockwave Flash"]){e=k.plugins["Shockwave Flash"].description&&!(a&&a["application/x-shockwave-flash"]&&!a["application/x-shockwave-flash"].enabledPlugin)}else{try{e=!(!i.ActiveXObject||!new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(c){n.log("Flash -- does not supported.")}}return e&&/^file:/i.test(l)&&n.log("[warn] Flash does not work on `file:` protocol."),e}(),n.support.flash&&(0||!n.html5||!n.support.html5||n.cors&&!n.support.cors||n.media&&!n.support.media)&&function(){function z(o){return('<object id="#id#" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+(o.width||"100%")+'" height="'+(o.height||"100%")+'"><param name="movie" value="#src#" /><param name="flashvars" value="#flashvars#" /><param name="swliveconnect" value="true" /><param name="allowscriptaccess" value="always" /><param name="allownetworking" value="all" /><param name="menu" value="false" /><param name="wmode" value="#wmode#" /><embed flashvars="#flashvars#" swliveconnect="true" allownetworking="all" allowscriptaccess="always" name="#id#" src="#src#" width="'+(o.width||"100%")+'" height="'+(o.height||"100%")+'" menu="false" wmode="transparent" type="application/x-shockwave-flash"></embed></object>').replace(/#(\w+)#/gi,function(p,q){return o[q]})}function y(p,o){if(p&&p.style){var s,r;for(s in o){r=o[s],"number"==typeof r&&(r+="px");try{p.style[s]=r}catch(q){}}}}function x(p,o){j(o,function(q,s){var r=p[s];p[s]=function(){return this.parent=r,q.apply(this,arguments)}})}function w(o){return o&&!o.flashId}function g(p){var o=p.wid=n.uid();return A._fn[o]=p,"FileAPI.Flash._fn."+o}function f(p){try{A._fn[p.wid]=null,delete A._fn[p.wid]}catch(o){}}function e(p,o){if(!B.test(p)){if(/^\.\//.test(p)||"/"!=p.charAt(0)){var q=l.pathname;q=q.substr(0,q.lastIndexOf("/")),p=(q+"/"+p).replace("/./","/")}"//"!=p.substr(0,2)&&(p="//"+l.host+p),B.test(p)||(p=l.protocol+p)}return o&&(p+=(/\?/.test(p)?"&":"?")+o),p}function d(G,F,E){function v(){try{var o=A.get(t);o.setImage(F)}catch(p){n.log('[err] FlashAPI.Preview.setImage -- can not set "base64":',p)}}var u,t=n.uid(),s=m.createElement("div"),r=10;for(u in G){s.setAttribute(u,G[u]),s[u]=G[u]}y(s,G),G.width="100%",G.height="100%",s.innerHTML=z(n.extend({id:t,src:e(n.flashImageUrl,"r="+n.uid()),wmode:"opaque",flashvars:"scale="+G.scale+"&callback="+g(function q(){return f(q),--r>0&&v(),!0})},G)),E(!1,s),s=null}function c(o){return{id:o.id,name:o.name,matrix:o.matrix,flashId:o.flashId}}function b(p){function o(r){var q,s;if(q=s=0,r.offsetParent){do{q+=r.offsetLeft,s+=r.offsetTop}while(r=r.offsetParent)}return{left:q,top:s}}p.getBoundingClientRect(),m.body,(p&&p.ownerDocument).documentElement;return{top:o(p).top,left:o(p).left,width:p.offsetWidth,height:p.offsetHeight}}var a=n.uid(),D=0,C={},B=/^https?:/i,A={_fn:{},publish:function(p,o,q){q=q||{},p.innerHTML=z({id:o,src:e(n.flashUrl,"r="+n.version),wmode:q.camera?"":"transparent",flashvars:"callback="+(q.onEvent||"FileAPI.Flash.onEvent")+"&flashId="+o+"&storeKey="+k.userAgent.match(/\d/gi).join("")+"_"+n.version+(A.isReady||(n.pingUrl?"&ping="+n.pingUrl:""))+"&timeout="+n.flashAbortTimeout+(q.camera?"&useCamera="+e(n.flashWebcamUrl):"")+"&debug="+(n.debug?"1":"")},q)},init:function(){var p=m.body&&m.body.firstChild;if(p){do{if(1==p.nodeType){n.log("FlashAPI.state: awaiting");var o=m.createElement("div");return o.id="_"+a,y(o,{top:1,right:1,width:5,height:5,position:"absolute",zIndex:1000000+""}),p.parentNode.insertBefore(o,p),void A.publish(o,a)}}while(p=p.nextSibling)}10>D&&setTimeout(A.init,50*++D)},ready:function(){n.log("FlashAPI.state: ready"),A.ready=n.F,A.isReady=!0,A.patch(),A.patchCamera&&A.patchCamera(),n.event.on(m,"mouseover",A.mouseover),n.event.on(m,"click",function(o){A.mouseover(o)&&(o.preventDefault?o.preventDefault():o.returnValue=!0)})},getEl:function(){return m.getElementById("_"+a)},getWrapper:function(o){do{if(/js-fileapi-wrapper/.test(o.className)){return o}}while((o=o.parentNode)&&o!==m.body)},disableMouseover:!1,mouseover:function(p){if(!A.disableMouseover){var o=n.event.fix(p).target;if(/input/i.test(o.nodeName)&&"file"==o.type&&!o.disabled){var t=o.getAttribute(a),s=A.getWrapper(o);if(n.multiFlash){if("i"==t||"r"==t){return !1}if("p"!=t){o.setAttribute(a,"i");var r=m.createElement("div");if(!s){return void n.log("[err] FlashAPI.mouseover: js-fileapi-wrapper not found")}y(r,{top:0,left:0,width:o.offsetWidth,height:o.offsetHeight,zIndex:1000000+"",position:"absolute"}),s.appendChild(r),A.publish(r,n.uid()),o.setAttribute(a,"p")}return !0}if(s){var q=b(s);y(A.getEl(),q),A.curInp=o}}else{/object|embed/i.test(o.nodeName)||y(A.getEl(),{top:1,left:1,width:5,height:5})}}},onEvent:function(p){var o=p.type;if("ready"==o){try{A.getInput(p.flashId).setAttribute(a,"r")}catch(q){}return A.ready(),setTimeout(function(){A.mouseenter(p)},50),!0}"ping"===o?n.log("(flash -> js).ping:",[p.status,p.savedStatus],p.error):"log"===o?n.log("(flash -> js).log:",p.target):o in A&&setTimeout(function(){n.log("FlashAPI.event."+p.type+":",p),A[o](p)},1)},mouseDown:function(){A.disableMouseover=!0},cancel:function(){A.disableMouseover=!1},mouseenter:function(p){var o=A.getInput(p.flashId);if(o){A.cmd(p,"multiple",null!=o.getAttribute("multiple"));var r=[],q={};j((o.getAttribute("accept")||"").split(/,\s*/),function(s){n.accept[s]&&j(n.accept[s].split(" "),function(t){q[t]=1})}),j(q,function(t,s){r.push(s)}),A.cmd(p,"accept",r.length?r.join(",")+","+r.join(",").toUpperCase():"*")}},get:function(o){return m[o]||i[o]||m.embeds[o]},getInput:function(p){if(!n.multiFlash){return A.curInp}try{var o=A.getWrapper(A.get(p));if(o){return o.getElementsByTagName("input")[0]}}catch(q){n.log('[err] Can not find "input" by flashId:',p,q)}},select:function(o){try{var s,r=A.getInput(o.flashId),q=n.uid(r),p=o.target.files;j(p,function(t){n.checkFileObj(t)}),C[q]=p,m.createEvent?(s=m.createEvent("Event"),s.files=p,s.initEvent("change",!0,!0),r.dispatchEvent(s)):h?h(r).trigger({type:"change",files:p}):(s=m.createEventObject(),s.files=p,r.fireEvent("onchange",s))}finally{A.disableMouseover=!1}},interval:null,cmd:function(p,o,r,q){A.uploadInProgress&&A.readInProgress?setTimeout(function(){A.cmd(p,o,r,q)},100):this.cmdFn(p,o,r,q)},cmdFn:function(p,o,s,r){try{return n.log("(js -> flash)."+o+":",s),A.get(p.flashId||p).cmd(o,s)}catch(q){n.log("(js -> flash).onError:",q),r||setTimeout(function(){A.cmd(p,o,s,!0)},50)}},patch:function(){n.flashEngine=!0,x(n,{readAsDataURL:function(p,o){w(p)?this.parent.apply(this,arguments):(n.log("FlashAPI.readAsBase64"),A.readInProgress=!0,A.cmd(p,"readAsBase64",{id:p.id,callback:g(function q(s,r){A.readInProgress=!1,f(q),n.log("FlashAPI.readAsBase64:",s),o({type:s?"error":"load",error:s,result:"data:"+p.type+";base64,"+r})})}))},readAsText:function(o,q,p){p?n.log("[warn] FlashAPI.readAsText not supported `encoding` param"):p=q,n.readAsDataURL(o,function(r){if("load"==r.type){try{r.result=i.atob(r.result.split(";base64,")[1])}catch(s){r.type="error",r.error=s.toString()}}p(r)})},getFiles:function(p,o,r){if(r){return n.filterFiles(n.getFiles(p),o,r),null}var q=n.isArray(p)?p:C[n.uid(p.target||p.srcElement||p)];return q?(o&&(o=n.getFilesFilter(o),q=n.filter(q,function(s){return o.test(s.name)})),q):this.parent.apply(this,arguments)},getInfo:function(p,o){if(w(p)){this.parent.apply(this,arguments)}else{if(p.isShot){o(null,p.info={width:p.width,height:p.height})}else{if(!p.__info){var q=p.__info=n.defer();q.resolve(null,p.info=null)}p.__info.then(o)}}}}),n.support.transform=!0,n.Image&&x(n.Image.prototype,{get:function(p,o){return this.set({scaleMode:o||"noScale"}),this.parent(p)},_load:function(p,o){if(n.log("FlashAPI.Image._load:",p),w(p)){this.parent.apply(this,arguments)}else{var q=this;n.getInfo(p,function(r){o.call(q,r,p)})}},_apply:function(p,o){if(n.log("FlashAPI.Image._apply:",p),w(p)){this.parent.apply(this,arguments)}else{var s=this.getMatrix(p.info),r=o;A.cmd(p,"imageTransform",{id:p.id,matrix:s,callback:g(function q(u,t){n.log("FlashAPI.Image._apply.callback:",u),f(q),u?r(u):n.support.html5||n.support.dataURI&&!(t.length>30000)?(s.filter&&(r=function(v,E){v?o(v):n.Image.applyFilter(E,s.filter,function(){o(v,this.canvas)})}),n.newImage("data:"+p.type+";base64,"+t,r)):d({width:s.deg%180?s.dh:s.dw,height:s.deg%180?s.dw:s.dh,scale:s.scaleMode},t,r)})})}},toData:function(p){var o=this.file,r=o.info,q=this.getMatrix(r);n.log("FlashAPI.Image.toData"),w(o)?this.parent.apply(this,arguments):("auto"==q.deg&&(q.deg=n.Image.exifOrientation[r&&r.exif&&r.exif.Orientation]||0),p.call(this,!o.info,{id:o.id,flashId:o.flashId,name:o.name,type:o.type,matrix:q}))}}),n.Image&&x(n.Image,{fromDataURL:function(p,o,q){!n.support.dataURI||p.length>30000?d(n.extend({scale:"exactFit"},o),p.replace(/^data:[^,]+,/,""),function(s,r){q(r)}):this.parent(p,o,q)}}),x(n.Form.prototype,{toData:function(p){for(var o=this.items,q=o.length;q--;){if(o[q].file&&w(o[q].blob)){return this.parent.apply(this,arguments)}}n.log("FlashAPI.Form.toData"),p(o)}}),x(n.XHR.prototype,{_send:function(p,o){if(o.nodeName||o.append&&n.support.html5||n.isArray(o)&&"string"==typeof o[0]){return this.parent.apply(this,arguments)}var v,u,t={},s={},r=this;if(j(o,function(E){E.file?(s[E.name]=E=c(E.blob),u=E.id,v=E.flashId):t[E.name]=E.blob}),u||(v=a),!v){return n.log("[err] FlashAPI._send: flashId -- undefined"),this.parent.apply(this,arguments)}n.log("FlashAPI.XHR._send: "+v+" -> "+u),r.xhr={headers:{},abort:function(){A.uploadInProgress=!1,A.cmd(v,"abort",{id:u})},getResponseHeader:function(E){return this.headers[E]},getAllResponseHeaders:function(){return this.headers}};var q=n.queue(function(){A.uploadInProgress=!0,A.cmd(v,"upload",{url:e(p.url.replace(/([a-z]+)=(\?)&?/i,"")),data:t,files:u?s:null,headers:p.headers||{},callback:g(function E(H){var G=H.type,F=H.result;n.log("FlashAPI.upload."+G),"progress"==G?(H.loaded=Math.min(H.loaded,H.total),H.lengthComputable=!0,p.progress(H)):"complete"==G?(A.uploadInProgress=!1,f(E),"string"==typeof F&&(r.responseText=F.replace(/%22/g,'"').replace(/%5c/g,"\\").replace(/%26/g,"&").replace(/%25/g,"%")),r.end(H.status||200)):("abort"==G||"error"==G)&&(A.uploadInProgress=!1,r.end(H.status||0,H.message),f(E))})})});j(s,function(E){q.inc(),n.getInfo(E,q.next)}),q.check()}})}};n.Flash=A,n.newImage("data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",function(p,o){n.support.dataURI=!(1!=o.width||1!=o.height),A.init()})}()}(window,window.jQuery,FileAPI),function(g,f,j){var i=j.each,h=[];j.support.flash&&j.media&&!j.support.media&&!function(){function d(l){var k=l.wid=j.uid();return j.Flash._fn[k]=l,"FileAPI.Flash._fn."+k}function c(l){try{j.Flash._fn[l.wid]=null,delete j.Flash._fn[l.wid]}catch(k){}}var e=j.Flash;j.extend(j.Flash,{patchCamera:function(){j.Camera.fallback=function(m,l,k){var b=j.uid();j.log("FlashAPI.Camera.publish: "+b),e.publish(m,b,j.extend(l,{camera:!0,onEvent:d(function a(n){"camera"===n.type&&(c(a),n.error?(j.log("FlashAPI.Camera.publish.error: "+n.error),k(n.error)):(j.log("FlashAPI.Camera.publish.success: "+b),k(null)))})}))},i(h,function(b){j.Camera.fallback.apply(j.Camera,b)}),h=[],j.extend(j.Camera.prototype,{_id:function(){return this.video.id},start:function(k){var b=this;e.cmd(this._id(),"camera.on",{callback:d(function a(l){c(a),l.error?(j.log("FlashAPI.camera.on.error: "+l.error),k(l.error,b)):(j.log("FlashAPI.camera.on.success: "+b._id()),b._active=!0,k(null,b))})})},stop:function(){this._active=!1,e.cmd(this._id(),"camera.off")},shot:function(){j.log("FlashAPI.Camera.shot:",this._id());var b=j.Flash.cmd(this._id(),"shot",{});return b.type="image/png",b.flashId=this._id(),b.isShot=!0,new j.Camera.Shot(b)}})}}),j.Camera.fallback=function(){h.push(arguments)}}()}(window,window.jQuery,FileAPI),"function"==typeof define&&define.amd&&define("FileAPI",[],function(){return FileAPI});