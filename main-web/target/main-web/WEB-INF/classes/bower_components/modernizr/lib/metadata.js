var fs=require("fs");var file=require("file");var marked=require("marked");var polyfills=require("./polyfills.json");var viewRoot=fs.realpathSync(__dirname+"/../feature-detects");function metadata(a){var b=[];file.walkSync(viewRoot,function(e,d,c){c.forEach(function(f){if(f===".DS_Store"){return}var l=fs.readFileSync(e+"/"+f,"utf8");var t=/\/\*\!([\s\S]*)\!\*\//m;var h=l.match(t);var g=/\/\*\sDOC([\s\S]*?)\*\//m;var r=l.match(g);var p=/define\((\[[^\]]*\]),/;var m=l.match(p);var n;if(h&&h[1]){try{n=JSON.parse(h[1])}catch(k){throw new Error("Error Parsing Metadata: "+f+"\nInput: `"+h[1]+"`")}}else{n={}}var j=null;if(r&&r[1]){j=marked(r[1].trim())}n.doc=j;var s=[];var i;if(m&&m[1]){try{i=JSON.parse(m[1].replace(/'/g,'"'))}catch(k){throw new Error("Couldn't parse dependencies for `"+f+"`:\n`"+m[1]+"\n`")}i.forEach(function(u){if(u==="Modernizr"){return}s.push(u)})}else{throw new Error("Couldn't find the define for `"+f+"`")}n.deps=s;var o=__dirname.replace(/lib$/,"");n.path="./"+(e+"/"+f).replace(o,"").replace(/\\/g,"/");n.amdPath=n.path.replace(/^\.\/feature\-detects/,"test").replace(/\.js$/i,"");if(!n.name){n.name=n.amdPath}var q=[];if(n.polyfills&&n.polyfills.length){n.polyfills.forEach(function(u){if(polyfills[u]){q.push(polyfills[u])}else{throw new Error(n.name+": Polyfill not found in `"+f+"`: "+u)}})}n.polyfills=q;if(!n.async){n.async=false}if(!n.notes){n.notes=[]}if(!n.warnings){n.warnings=[]}if(!n.caniuse){n.caniuse=null}if(!n.cssclass&&n.property){n.cssclass=n.property}else{n.cssclass=null}if(!n.doc&&n.docs){n.doc=n.docs;delete n.docs}if(!n.tags){n.tags=[]}if(!n.authors){n.authors=[]}if(!n.knownBugs){n.knownBugs=[]}b.push(n)})});if(a&&typeof a=="function"){return a(b)}return b}module.exports=metadata;