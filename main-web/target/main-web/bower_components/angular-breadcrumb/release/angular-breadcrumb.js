/*! angular-breadcrumb - v0.5.0
* http://ncuillery.github.io/angular-breadcrumb
* Copyright (c) 2016 Nicolas Cuillery; Licensed MIT */
(function(j,k,h){function m(p,o){if(k.equals(p.length,o.length)){return p>o}else{return p.length>o.length}}function e(p){var o=p.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!o||o.length!==4){throw new Error("Invalid state ref '"+p+"'")}return{state:o[1],paramExpr:o[3]||null}}var g={};function f(p,o,s,r){var q=g[p];if(q!==h){q()}q=o.$on(s,r);g[p]=q}function c(){var o={prefixStateName:null,template:"bootstrap3",templateUrl:null,templateLast:"default",templateLastUrl:null,includeAbstract:false};this.setOptions=function(p){k.extend(o,p)};this.$get=["$state","$stateParams","$rootScope",function(t,u,q){var v=q;f("$Breadcrumb.$viewContentLoaded",q,"$viewContentLoaded",function(w){if(!w.targetScope.ncyBreadcrumbIgnore&&m(w.targetScope.$id,v.$id)){v=w.targetScope}});var r=function(y){var x=y.parent||(/^(.+)\.[^.]+$/.exec(y.name)||[])[1];var w=typeof x==="object";return w?x.name:x};var s=function(w,C){var B,E,y=e(C),x=false,D=false;for(var A=0,z=w.length;A<z;A+=1){if(w[A].name===y.state){return}}B=t.get(y.state);if(B.ncyBreadcrumb){if(B.ncyBreadcrumb.force){x=true}if(B.ncyBreadcrumb.skip){D=true}}if((!B["abstract"]||o.includeAbstract||x)&&!D){if(y.paramExpr){E=v.$eval(y.paramExpr)}B.ncyBreadcrumbLink=t.href(y.state,E||u||{});B.ncyBreadcrumbStateRef=C;w.unshift(B)}};var p=function(w){var y=e(w),x=t.get(y.state);if(x.ncyBreadcrumb&&x.ncyBreadcrumb.parent){var z=typeof x.ncyBreadcrumb.parent==="function";var A=z?x.ncyBreadcrumb.parent(v):x.ncyBreadcrumb.parent;if(A){return A}}return r(x)};return{getTemplate:function(w){if(o.templateUrl){return null}else{if(w[o.template]){return w[o.template]}else{return o.template}}},getTemplateUrl:function(){return o.templateUrl},getTemplateLast:function(w){if(o.templateLastUrl){return null}else{if(w[o.templateLast]){return w[o.templateLast]}else{return o.templateLast}}},getTemplateLastUrl:function(){return o.templateLastUrl},getStatesChain:function(y){var x=[];for(var w=t.$current.self.name;w;w=p(w)){s(x,w);if(y&&x.length){return x}}if(o.prefixStateName){s(x,o.prefixStateName)}return x},getLastStep:function(){var w=this.getStatesChain(true);return w.length?w[0]:h},$getLastViewScope:function(){return v}}}]}var d=function(o){if(o.expressions){return o.expressions}else{var p=[];k.forEach(o.parts,function(q){if(k.isFunction(q)){p.push(q.exp)}});return p}};var b=function(r,o,p,q){k.forEach(d(o),function(t){var s=p.$watch(t,function(){q.ncyBreadcrumbLabel=o(p)});r.push(s)})};var a=function(o){k.forEach(o,function(p){p()})};function i(r,s,q){var p={bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'};return{restrict:"AE",replace:true,scope:{},template:s.getTemplate(p),templateUrl:s.getTemplateUrl(),link:{post:function o(u){var v=[];var t=function(){a(v);v=[];var w=s.$getLastViewScope();u.steps=s.getStatesChain();k.forEach(u.steps,function(x){if(x.ncyBreadcrumb&&x.ncyBreadcrumb.label){var y=r(x.ncyBreadcrumb.label);x.ncyBreadcrumbLabel=y(w);b(v,y,w,x)}else{x.ncyBreadcrumbLabel=x.name}})};f("BreadcrumbDirective.$viewContentLoaded",q,"$viewContentLoaded",function(w){if(!w.targetScope.ncyBreadcrumbIgnore){t()}});t()}}}}i.$inject=["$interpolate","$breadcrumb","$rootScope"];function n(q,r,p){var o={"default":"{{ncyBreadcrumbLabel}}"};return{restrict:"A",scope:{},template:r.getTemplateLast(o),templateUrl:r.getTemplateLastUrl(),compile:function(v,t){var u=v.attr(t.$attr.ncyBreadcrumbLast);if(u){v.html(u)}return{post:function s(x){var y=[];var w=function(){a(y);y=[];var z=r.$getLastViewScope();var A=r.getLastStep();if(A){x.ncyBreadcrumbLink=A.ncyBreadcrumbLink;if(A.ncyBreadcrumb&&A.ncyBreadcrumb.label){var B=q(A.ncyBreadcrumb.label);x.ncyBreadcrumbLabel=B(z);b(y,B,z,x)}else{x.ncyBreadcrumbLabel=A.name}}};f("BreadcrumbLastDirective.$viewContentLoaded",p,"$viewContentLoaded",function(z){if(!z.targetScope.ncyBreadcrumbIgnore){w()}});w()}}}}}n.$inject=["$interpolate","$breadcrumb","$rootScope"];function l(p,q,o){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(v,s){var t=v.attr(s.$attr.ncyBreadcrumbText);if(t){v.html(t)}var u=v.attr(s.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function r(x){var y=[];var z=function(C,A,B){k.forEach(d(A),function(E){var D=B.$watch(E,function(G,F){if(G!==F){w()}});C.push(D)})};var w=function(){a(y);y=[];var C=q.$getLastViewScope();var B=q.getStatesChain();var A=[];k.forEach(B,function(D){if(D.ncyBreadcrumb&&D.ncyBreadcrumb.label){var E=p(D.ncyBreadcrumb.label);A.push(E(C));z(y,E,C)}else{A.push(D.name)}});x.ncyBreadcrumbChain=A.join(u)};f("BreadcrumbTextDirective.$viewContentLoaded",o,"$viewContentLoaded",function(A){if(!A.targetScope.ncyBreadcrumbIgnore){w()}});w()}}}}}l.$inject=["$interpolate","$breadcrumb","$rootScope"];k.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",c).directive("ncyBreadcrumb",i).directive("ncyBreadcrumbLast",n).directive("ncyBreadcrumbText",l)})(window,window.angular);