/*! angular-breadcrumb - v0.4.1-dev-2016-04-12
* http://ncuillery.github.io/angular-breadcrumb
* Copyright (c) 2016 Nicolas Cuillery; Licensed MIT */
!function(B,A,z){function y(b,d){return A.equals(b.length,d.length)?b>d:b.length>d.length}function x(d){var c=d.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!c||4!==c.length){throw new Error("Invalid state ref '"+d+"'")}return{state:c[1],paramExpr:c[3]||null}}function w(g,c,j,i){var h=r[g];h!==z&&h(),h=c.$on(j,i),r[g]=h}function v(){var b={prefixStateName:null,template:"bootstrap3",templateUrl:null,templateLast:"default",templateLastUrl:null,includeAbstract:!1};this.setOptions=function(a){A.extend(b,a)},this.$get=["$state","$stateParams","$rootScope",function(a,n,m){var f=m;w("$Breadcrumb.$viewContentLoaded",m,"$viewContentLoaded",function(g){!g.targetScope.ncyBreadcrumbIgnore&&y(g.targetScope.$id,f.$id)&&(f=g.targetScope)});var e=function(h){var g=h.parent||(/^(.+)\.[^.]+$/.exec(h.name)||[])[1],i="object"==typeof g;return i?g.name:g},d=function(I,H){for(var G,F,E=x(H),D=!1,C=!1,i=0,g=I.length;g>i;i+=1){if(I[i].name===E.state){return}}G=a.get(E.state),G.ncyBreadcrumb&&(G.ncyBreadcrumb.force&&(D=!0),G.ncyBreadcrumb.skip&&(C=!0)),G["abstract"]&&!b.includeAbstract&&!D||C||(E.paramExpr&&(F=f.$eval(E.paramExpr)),G.ncyBreadcrumbLink=a.href(E.state,F||n||{}),G.ncyBreadcrumbStateRef=H,I.unshift(G))},c=function(h){var l=x(h),k=a.get(l.state);if(k.ncyBreadcrumb&&k.ncyBreadcrumb.parent){var j="function"==typeof k.ncyBreadcrumb.parent,i=j?k.ncyBreadcrumb.parent(f):k.ncyBreadcrumb.parent;if(i){return i}}return e(k)};return{getTemplate:function(g){return b.templateUrl?null:g[b.template]?g[b.template]:b.template},getTemplateUrl:function(){return b.templateUrl},getTemplateLast:function(g){return b.templateLastUrl?null:g[b.templateLast]?g[b.templateLast]:b.templateLast},getTemplateLastUrl:function(){return b.templateLastUrl},getStatesChain:function(i){for(var h=[],g=a.$current.self.name;g;g=c(g)){if(d(h,g),i&&h.length){return h}}return b.prefixStateName&&d(h,b.prefixStateName),h},getLastStep:function(){var g=this.getStatesChain(!0);return g.length?g[0]:z},$getLastViewScope:function(){return f}}}]}function u(b,h,g){var f={bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'};return{restrict:"AE",replace:!0,scope:{},template:h.getTemplate(f),templateUrl:h.getTemplateUrl(),link:{post:function(d){var c=[],a=function(){o(c),c=[];var e=h.$getLastViewScope();d.steps=h.getStatesChain(),A.forEach(d.steps,function(i){if(i.ncyBreadcrumb&&i.ncyBreadcrumb.label){var j=b(i.ncyBreadcrumb.label);i.ncyBreadcrumbLabel=j(e),p(c,j,e,i)}else{i.ncyBreadcrumbLabel=i.name}})};w("BreadcrumbDirective.$viewContentLoaded",g,"$viewContentLoaded",function(e){e.targetScope.ncyBreadcrumbIgnore||a()}),a()}}}}function t(f,e,h){var g={"default":"{{ncyBreadcrumbLabel}}"};return{restrict:"A",scope:{},template:e.getTemplateLast(g),templateUrl:e.getTemplateLastUrl(),compile:function(c,b){var a=c.attr(b.$attr.ncyBreadcrumbLast);return a&&c.html(a),{post:function(k){var j=[],i=function(){o(j),j=[];var m=e.$getLastViewScope(),l=e.getLastStep();if(l){if(k.ncyBreadcrumbLink=l.ncyBreadcrumbLink,l.ncyBreadcrumb&&l.ncyBreadcrumb.label){var d=f(l.ncyBreadcrumb.label);k.ncyBreadcrumbLabel=d(m),p(j,d,m,k)}else{k.ncyBreadcrumbLabel=l.name}}};w("BreadcrumbLastDirective.$viewContentLoaded",h,"$viewContentLoaded",function(d){d.targetScope.ncyBreadcrumbIgnore||i()}),i()}}}}}function s(b,f,e){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(j,d){var c=j.attr(d.$attr.ncyBreadcrumbText);c&&j.html(c);var a=j.attr(d.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function(m){var l=[],k=function(g,n,h){A.forEach(q(n),function(C){var D=h.$watch(C,function(F,E){F!==E&&i()});g.push(D)})},i=function(){o(l),l=[];var n=f.$getLastViewScope(),h=f.getStatesChain(),g=[];A.forEach(h,function(C){if(C.ncyBreadcrumb&&C.ncyBreadcrumb.label){var D=b(C.ncyBreadcrumb.label);g.push(D(n)),k(l,D,n)}else{g.push(C.name)}}),m.ncyBreadcrumbChain=g.join(a)};w("BreadcrumbTextDirective.$viewContentLoaded",e,"$viewContentLoaded",function(g){g.targetScope.ncyBreadcrumbIgnore||i()}),i()}}}}}var r={},q=function(b){if(b.expressions){return b.expressions}var d=[];return A.forEach(b.parts,function(c){A.isFunction(c)&&d.push(c.exp)}),d},p=function(b,h,g,f){A.forEach(q(h),function(a){var c=g.$watch(a,function(){f.ncyBreadcrumbLabel=h(g)});b.push(c)})},o=function(b){A.forEach(b,function(c){c()})};u.$inject=["$interpolate","$breadcrumb","$rootScope"],t.$inject=["$interpolate","$breadcrumb","$rootScope"],s.$inject=["$interpolate","$breadcrumb","$rootScope"],A.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",v).directive("ncyBreadcrumb",u).directive("ncyBreadcrumbLast",t).directive("ncyBreadcrumbText",s)}(window,window.angular);