"use strict";
/*!
 * Script to update version number references in the project.
 * Copyright 2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */
var fs=require("fs");var path=require("path");var sh=require("shelljs");sh.config.fatal=true;var sed=sh.sed;RegExp.quote=function(a){return a.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")};RegExp.quoteReplacement=function(a){return a.replace(/[$]/g,"$$")};var DRY_RUN=false;function walkAsync(a,c,d,b){if(c.has(path.parse(a).base)){return}fs.readdir(a,function(e,f){if(e){b(e);return}f.forEach(function(g){var h=path.join(a,g);fs.lstat(h,function(j,i){if(j){process.nextTick(b,j);return}if(i.isSymbolicLink()){return}else{if(i.isDirectory()){process.nextTick(walkAsync,h,c,d,b)}else{if(i.isFile()){process.nextTick(d,h)}}}})})})}function replaceRecursively(c,d,b,e,f){e=new RegExp(RegExp.quote(e),"g");f=RegExp.quoteReplacement(f);var a=!DRY_RUN?function(g){if(b.has(path.parse(g).ext)){sed("-i",e,f,g)}}:function(g){if(b.has(path.parse(g).ext)){console.log("FILE: "+g)}else{console.log("EXCLUDED:"+g)}};walkAsync(c,d,a,function(g){console.error("ERROR while traversing directory!:");console.error(g);process.exit(1)})}function main(c){if(c.length!==2){console.error("USAGE: change-version old_version new_version");console.error("Got arguments:",c);process.exit(1)}var b=c[0];var e=c[1];var a=new Set([".git","node_modules","vendor"]);var d=new Set(["",".css",".html",".js",".json",".less",".md",".nuspec",".ps1",".scss",".txt",".yml"]);replaceRecursively(".",a,d,b,e)}main(process.argv.slice(2));