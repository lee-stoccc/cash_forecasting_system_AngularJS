angular.module("ui.bootstrap.datetimepicker",["ui.bootstrap.dateparser","ui.bootstrap.position"]).constant("uiDatetimePickerConfig",{dateFormat:"yyyy-MM-dd HH:mm",defaultTime:"00:00:00",html5Types:{date:"yyyy-MM-dd","datetime-local":"yyyy-MM-ddTHH:mm:ss.sss",month:"yyyy-MM"},initialPicker:"date",reOpenDefault:false,enableDate:true,enableTime:true,buttonBar:{show:true,now:{show:true,text:"现在"},today:{show:true,text:"今天"},clear:{show:true,text:"清除"},date:{show:true,text:"日期"},time:{show:true,text:"时间"},close:{show:true,text:"关闭"}},closeOnDateSelection:true,closeOnTimeNow:true,appendToBody:false,altInputFormats:[],ngModelOptions:{},saveAs:false,readAs:false}).controller("DateTimePickerController",["$scope","$element","$attrs","$compile","$parse","$document","$timeout","$uibPosition","dateFilter","uibDateParser","uiDatetimePickerConfig","$rootScope","$translate",function(t,q,j,z,h,C,A,F,m,u,r,n,w){var v=r.dateFormat,o,l,s,p={},x=[],b=angular.isDefined(j.closeOnDateSelection)?t.$parent.$eval(j.closeOnDateSelection):r.closeOnDateSelection,k=angular.isDefined(j.closeOnTimeNow)?t.$parent.$eval(j.closeOnTimeNow):r.closeOnTimeNow,B=angular.isDefined(j.datepickerAppendToBody)?t.$parent.$eval(j.datepickerAppendToBody):r.appendToBody,e=angular.isDefined(j.altInputFormats)?t.$parent.$eval(j.altInputFormats):r.altInputFormats,c=angular.isDefined(j.saveAs)?t.$parent.$eval(j.saveAs)||j.saveAs:r.saveAs,y=angular.isDefined(j.readAs)?t.$parent.$eval(j.readAs):r.readAs;this.init=function(K){o=K;l=o.$options||r.ngModelOptions;t.buttonBar=angular.isDefined(j.buttonBar)?t.$parent.$eval(j.buttonBar):r.buttonBar;t.enableDate=angular.isDefined(t.enableDate)?t.enableDate:r.enableDate;t.enableTime=angular.isDefined(t.enableTime)?t.enableTime:r.enableTime;t.initialPicker=angular.isDefined(j.initialPicker)?j.initialPicker:(t.enableDate?r.initialPicker:"time");t.reOpenDefault=angular.isDefined(j.reOpenDefault)?j.reOpenDefault:r.reOpenDefault;if(t.initialPicker=="date"&&!t.enableDate){throw new Error("datetimePicker can't have initialPicker set to date and have enableDate set to false.")}t.showPicker=!t.enableDate?"time":t.initialPicker;var L=false;if(r.html5Types[j.type]){v=r.html5Types[j.type];L=true}else{v=j.datetimePicker||r.dateFormat;j.$observe("datetimePicker",function(P){var O=P||r.dateFormat;if(O!==v){v=O;o.$modelValue=null;if(!v){throw new Error("datetimePicker must have a date format specified.")}}})}if(!v){throw new Error("datetimePicker must have a date format specified.")}var N=angular.element('<div date-picker-wrap><div uib-datepicker></div></div><div time-picker-wrap><div uib-timepicker style="margin:0 auto"></div></div>');if(l){timezone=l.timezone;t.ngModelOptions=angular.copy(l);t.ngModelOptions.timezone=null;if(t.ngModelOptions.updateOnDefault===true){t.ngModelOptions.updateOn=t.ngModelOptions.updateOn?t.ngModelOptions.updateOn+" default":"default"}N.attr("ng-model-options","ngModelOptions")}else{timezone=null}N.attr({"ng-model":"date","ng-change":"dateSelection(date)"});var J=angular.element(N.children()[0]);if(!t.datepickerOptions){t.datepickerOptions={}}if(L){if(j.type==="month"){t.datepickerOptions.datepickerMode="month";t.datepickerOptions.minMode="month"}}J.attr("datepicker-options","datepickerOptions");if(!angular.isDefined(t.datepickerOptions.datepickerMode)){t.datepickerOptions.datepickerMode="day"}var H=angular.element(N.children()[1]);if(!t.timepickerOptions){t.timepickerOptions={}}for(var I in t.timepickerOptions){H.attr(f(I),"timepickerOptions."+I)}angular.forEach(["minDate","maxDate","initDate"],function(O){if(t.datepickerOptions[O]){if(O=="minDate"){H.attr("min","datepickerOptions.minDate")}else{if(O=="maxDate"){H.attr("max","datepickerOptions.maxDate")}}}});if(!L){o.$$parserName="datetime";o.$validators.datetime=i;o.$parsers.unshift(E);o.$formatters.push(function(O){if(o.$isEmpty(O)){t.date=O;return O}t.date=u.fromTimezone(O,l.timezone);v=v.replace(/M!/,"MM").replace(/d!/,"dd");return u.filter(t.date,v)})}else{o.$formatters.push(function(O){t.date=u.fromTimezone(O,l.timezone);return O})}if(c){if(angular.isFunction(c)){o.$parsers.push(c)}else{o.$parsers.push(G)}if(angular.isFunction(y)){o.$formatters.push(y)}else{o.$formatters.push(M)}}o.$viewChangeListeners.push(function(){t.date=D(o.$viewValue)});q.bind("keydown",d);s=z(N)(t);N.remove();if(B){C.find("body").append(s)}else{q.after(s)}function M(O){if(o.$isEmpty(O)){return O}var P=new Date(O);if(angular.isDate(P)&&!isNaN(P)){return P}return O}function G(O){if(!O||angular.isString(O)||!angular.isDate(O)||isNaN(O)){return O}if(c==="ISO"){return O.toISOString()}if(c==="json"){return O.toJSON()}if(c==="number"){return O.valueOf()}if(!L){v=v.replace(/M!/,"MM").replace(/d!/,"dd");return u.filter(u.fromTimezone(O,l.timezone),v)}else{return u.fromTimezone(O,l.timezone).toLocaleString()}}};t.getText=function(G){r.buttonBar[G].text=t.buttonBar[G].text=w.instant("global.today");if("clear"===G){r.buttonBar[G].text=t.buttonBar[G].text=w.instant("global.clear")}if("close"===G){r.buttonBar[G].text=t.buttonBar[G].text=w.instant("global.close")}if("time"===G){r.buttonBar[G].text=t.buttonBar[G].text=w.instant("global.time")}if("now"===G){r.buttonBar[G].text=t.buttonBar[G].text=w.instant("global.now")}if("date"===G){r.buttonBar[G].text=t.buttonBar[G].text=w.instant("global.messages.validate.date")}return t.buttonBar[G].text||r.buttonBar[G].text};t.keydown=function(G){if(G.which===27){t.close(false);q[0].focus()}};t.doShow=function(G){if(angular.isDefined(t.buttonBar[G].show)){return t.buttonBar[G].show}else{return r.buttonBar[G].show}};t.dateSelection=function(K,J){if(t.enableTime&&t.showPicker==="time"){if(K||K!=null){if(!angular.isDefined(t.date)||t.date==null){t.date=new Date()}if(K&&K!=null){var H=new Date(t.date);H.setHours(K.getHours());H.setMinutes(K.getMinutes());H.setSeconds(K.getSeconds());H.setMilliseconds(K.getMilliseconds());K=H}}}if(angular.isDefined(K)){if(!t.date){var G=angular.isDefined(j.defaultTime)?j.defaultTime:r.defaultTime;var I=new Date("2001-01-01 "+G);if(!isNaN(I)&&K!=null){K.setHours(I.getHours());K.setMinutes(I.getMinutes());K.setSeconds(I.getSeconds());K.setMilliseconds(I.getMilliseconds())}}t.date=K}var H=t.date?m(t.date,v):null;q.val(H);o.$setViewValue(H);if(b){if(t.showPicker!="time"&&H!=null){if(t.enableTime){t.open("time")}else{t.close(false)}}else{if(k&&t.showPicker==="time"&&H!=null&&J==="now"){t.close(false)}}}};t.$watch("isOpen",function(H){t.dropdownStyle={display:H?"block":"none"};if(H){p.openDate=t.date;var G=B?F.offset(q):F.position(q);if(B){t.dropdownStyle.top=(G.top+q.prop("offsetHeight"))+"px"}else{t.dropdownStyle.top=undefined}t.dropdownStyle.left=G.left+"px";A(function(){t.$broadcast("uib:datepicker.focus");C.bind("click",a)},0,false);t.open(t.showPicker)}else{C.unbind("click",a)}});t.isDisabled=function(G){if(G==="today"||G==="now"){G=u.fromTimezone(new Date(),timezone)}var H={};angular.forEach(["minDate","maxDate"],function(I){if(!t.datepickerOptions[I]){H[I]=null}else{if(angular.isDate(t.datepickerOptions[I])){H[I]=u.fromTimezone(new Date(t.datepickerOptions[I]),timezone)}else{H[I]=new Date(m(t.datepickerOptions[I],"medium"))}}});return t.datepickerOptions&&H.minDate&&t.compare(G,H.minDate)<0||H.maxDate&&t.compare(G,H.maxDate)>0};t.compare=function(H,G){return new Date(H.getFullYear(),H.getMonth(),H.getDate())-new Date(G.getFullYear(),G.getMonth(),G.getDate())};t.select=function(J,G){if(angular.isDefined(G)){G.preventDefault();G.stopPropagation()}var I=null;var K=J==="now";if(J==="today"||J=="now"){var H=new Date();if(angular.isDate(t.date)){I=new Date(t.date);I.setFullYear(H.getFullYear(),H.getMonth(),H.getDate());I.setHours(H.getHours(),H.getMinutes(),H.getSeconds(),H.getMilliseconds())}else{I=H}}t.dateSelection(I,J)};t.open=function(H,G){if(angular.isDefined(G)){G.preventDefault();G.stopPropagation()}A(function(){t.showPicker=H},0);if(H=="time"){A(function(){t.date=D(o.$viewValue)},50)}};t.close=function(H,G){if(angular.isDefined(G)){G.preventDefault();G.stopPropagation()}t.isOpen=false;if(t.enableDate&&t.enableTime){t.showPicker=t.reOpenDefault===false?"date":t.reOpenDefault}if(angular.isDefined(H)){t.whenClosed({args:{closePressed:H,openDate:p.openDate||null,closeDate:t.date}})}else{q[0].focus()}};t.$on("$destroy",function(){if(t.isOpen===true){if(!n.$$phase){t.$apply(function(){t.close()})}}x.forEach(function(G){G()});s.remove();q.unbind("keydown",d);C.unbind("click",a)});function a(H){var G=s[0];var J=q[0].contains(H.target);var I=G.contains!==undefined&&G.contains(H.target);if(t.isOpen&&!(J||I)){t.$apply(function(){t.close(false)})}}function d(G){if(G.which===27&&t.isOpen){G.preventDefault();G.stopPropagation();t.$apply(function(){t.close(false)});q[0].focus()}else{if(G.which===40&&!t.isOpen){G.preventDefault();G.stopPropagation();t.$apply(function(){t.isOpen=true})}}}function f(G){return G.replace(/([A-Z])/g,function(H){return"-"+H.toLowerCase()})}function D(I){var G=u.parse(I,v,t.date);if(isNaN(G)){for(var H=0;H<e.length;H++){G=u.parse(I,e[H],t.date);if(!isNaN(G)){return G}}}return G}function E(H){if(angular.isNumber(H)&&!isNaN(H)){H=new Date(H)}if(!H){return null}if(angular.isDate(H)&&!isNaN(H)){return H}if(angular.isString(H)){var G=D(H);if(!isNaN(G)){return u.toTimezone(G,l.timezone)}return undefined}else{return undefined}}function g(G){if(t.datepickerOptions.minDate&&G<t.datepickerOptions.minDate){return false}else{if(t.datepickerOptions.maxDate&&G>t.datepickerOptions.maxDate){return false}else{return true}}}function i(G,I){var H=G||I;if(!(j.ngRequired||j.required)&&!H){return true}if(angular.isNumber(H)){H=new Date(H)}if(!H){return true}else{if(angular.isDate(H)&&!isNaN(H)){return g(H)}else{if(angular.isDate(new Date(H))&&!isNaN(new Date(H).valueOf())){return g(new Date(H))}else{if(angular.isString(H)){return !isNaN(D(I))&&g(D(I))}else{return false}}}}}}]).directive("datetimePicker",function(){return{restrict:"A",require:["ngModel","datetimePicker"],controller:"DateTimePickerController",scope:{isOpen:"=?",datepickerOptions:"=?",timepickerOptions:"=?",enableDate:"=?",enableTime:"=?",initialPicker:"=?",reOpenDefault:"=?",whenClosed:"&"},link:function(d,c,b,a){var f=a[0],e=a[1];e.init(f)}}}).directive("datePickerWrap",function(){return{restrict:"EA",replace:true,transclude:true,templateUrl:"template/date-picker.html"}}).directive("timePickerWrap",function(){return{restrict:"EA",replace:true,transclude:true,templateUrl:"template/time-picker.html"}});angular.module("ui.bootstrap.datetimepicker").run(["$templateCache",function(a){a.put("template/date-picker.html",'<ul class="dropdown-menu dropdown-menu-left datetime-picker-dropdown" ng-if="isOpen && showPicker == \'date\'" ng-style=dropdownStyle style=left:inherit ng-keydown=keydown($event) ng-click="$event.preventDefault(); $event.stopPropagation()"><li style="padding:0 5px 5px 5px" class=date-picker-menu><div ng-transclude></div></li><li style=padding:5px ng-if=buttonBar.show><span class="btn-group pull-left" style=margin-right:10px ng-if="doShow(\'today\') || doShow(\'clear\')"><button type=button class="btn btn-sm btn-info" ng-if="doShow(\'today\')" ng-click="select(\'today\', $event)" ng-disabled="isDisabled(\'today\')">{{ getText(\'today\') }}</button> <button type=button class="btn btn-sm btn-danger" ng-if="doShow(\'clear\')" ng-click="select(\'clear\', $event)">{{ getText(\'clear\') }}</button></span> <span class="btn-group pull-right" ng-if="(doShow(\'time\') && enableTime) || doShow(\'close\')"><button type=button class="btn btn-sm btn-default" ng-if="doShow(\'time\') && enableTime" ng-click="open(\'time\', $event)">{{ getText(\'time\')}}</button> <button type=button class="btn btn-sm btn-success" ng-if="doShow(\'close\')" ng-click="close(true, $event)">{{ getText(\'close\') }}</button></span> <span class=clearfix></span></li></ul>');a.put("template/time-picker.html",'<ul class="dropdown-menu dropdown-menu-left datetime-picker-dropdown" ng-if="isOpen && showPicker == \'time\'" ng-style=dropdownStyle style=left:inherit ng-keydown=keydown($event) ng-click="$event.preventDefault(); $event.stopPropagation()"><li style="padding:0 5px 5px 5px" class=time-picker-menu><div ng-transclude></div></li><li style=padding:5px ng-if=buttonBar.show><span class="btn-group pull-left" style=margin-right:10px ng-if="doShow(\'now\') || doShow(\'clear\')"><button type=button class="btn btn-sm btn-info" ng-if="doShow(\'now\')" ng-click="select(\'now\', $event)" ng-disabled="isDisabled(\'now\')">{{ getText(\'now\') }}</button> <button type=button class="btn btn-sm btn-danger" ng-if="doShow(\'clear\')" ng-click="select(\'clear\', $event)">{{ getText(\'clear\') }}</button></span> <span class="btn-group pull-right" ng-if="(doShow(\'date\') && enableDate) || doShow(\'close\')"><button type=button class="btn btn-sm btn-default" ng-if="doShow(\'date\') && enableDate" ng-click="open(\'date\', $event)">{{ getText(\'date\')}}</button> <button type=button class="btn btn-sm btn-success" ng-if="doShow(\'close\')" ng-click="close(true, $event)">{{ getText(\'close\') }}</button></span> <span class=clearfix></span></li></ul>')}]);