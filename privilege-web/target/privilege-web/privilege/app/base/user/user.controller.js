(function(){angular.module("devplatformApp").controller("UserManagementController",a);a.$inject=["PublicService","Principal","UserService","ParseLinks","AlertService","$state","paginationConstants","JhiLanguageService","$scope","$stateParams","ngDialog","$rootScope","RoleManagerService","$timeout","SysDictService"];function a(f,x,l,j,p,s,o,d,n,v,h,g,i,w,r){n.currentAccount=null;n.languages=null;n.clear=m;n.addUser=u;n.deleteUser=q;n.exportExcel=b;n.toEdit=k;n.selectRoles=t;n.resetPassword=e;n.userManage=f.showView("userManage");n.formParam={login:"",firstName:"",activated:""};d.getAll().then(function(y){n.languages=y});x.identity().then(function(y){n.currentAccount=y});r.getDictList("system.status").then(function(y){n.dictList=y.data});n.tablesConfig={showCheckBox:true,tableWidth:"table-default-width",tableTitles:[{title:"devplatformApp.user.login",filed:"login",type:"text",width:"table-item-pre-2"},{title:"devplatformApp.user.firstName",filed:"firstName",type:"text",width:"table-item-pre-2"},{title:"devplatformApp.user.activated",filed:"activated",type:"btn-status",width:"table-item-pre-2",actions:[{actionName:"enableUser(item.id,item.activated)",statusList:[{status:"0",showName:"global.disabled"},{status:"1",showName:"global.enabled"}]}]},{title:"devplatformApp.user.expireDate",filed:"expireDate",type:"date",width:"table-item-pre-2"},{title:"entity.action.operation",filed:"operation",type:"btn",width:"table-item-pre-4",actions:[{actionName:"toEdit(item.id)",name:"devplatformApp.user.home.edit",disabled:"item.activated",formEnglishName:"userManage",englishName:"editBtn"},{actionName:"selectRoles(item.id)",name:"devplatformApp.user.home.selectRoles",disabled:"item.activated",formEnglishName:"userManage",englishName:"selectRolesBtn"},{actionName:"resetPassword(item.id)",name:"devplatformApp.user.home.resetPassword",disabled:"item.activated",formEnglishName:"userManage",englishName:"resetPasswordBtn"}]}],url:"api/user/list",formParams:{login:n.formParam.login,firstName:n.formParam.firstName,activated:n.formParam.activated}};n.loadAll=function(){n.refreshTableList(n.formParam)};function c(y){p.error(y.data.message)}function m(){n.formParam={login:"",firstName:"",activated:""}}function u(){s.go("app.user-edit",{id:"",menuId:""})}function q(){n.choseArr=n.getCheckValues("activated").check;n.choseArrParam=n.getCheckValues("activated").checkedParamFlags;var z="";var y=false;if(n.choseArr[0]==""||n.choseArr.length==0){z="devplatformApp.user.prompt.selectOne";y=true}else{if(n.choseArrParam.indexOf("1")!=-1){z="devplatformApp.user.prompt.cannotBeDelete";y=true}}if(y){n.message=z;n.type="";f.showMessageDialog(n);return}h.openConfirm({template:"app/common/dialog.html",className:"ngdialog-theme-default",scope:n,controller:["$scope",function(A){A.message="devplatformApp.user.delete.question";A.type="confirm";A.confirm=function(){var C="";for(var B=0;B<A.choseArr.length;B++){if(B===0){C+="'"+A.choseArr[B]+"'"}else{C+=",'"+A.choseArr[B]+"'"}}l.deleteUser(C).then(function(){A.loadAll();A.closeThisDialog();z="global.deleteSuccess";f.openDialog(z)})}}]})}function k(y){s.go("app.user-edit",{id:y})}function b(){n.message="devplatformApp.user.prompt.inDevelopment";f.showMessageDialog(n)}function t(y){s.go("app.user-select-roles",{userId:y})}function e(y){n.message="devplatformApp.user.prompt.confirmReset";n.type="confirm";h.openConfirm({template:"app/common/dialog.html",className:"ngdialog-theme-default",scope:n,controller:["$scope",function(z){z.confirm=function(){l.resetPassword(y).then(function(){z.message="devplatformApp.user.prompt.resetSuccess";z.type="";w(function(){h.close()},2000)})}}]})}n.enableUser=function(z,y){if(y=="0"||y==null||y==undefined){n.message="devplatformApp.user.prompt.confirmEnable";y="1"}else{if(y=="1"){n.message="devplatformApp.user.prompt.confirmDisable";y="0"}}n.type="confirm";h.openConfirm({template:"app/common/dialog.html",className:"ngdialog-theme-default",scope:n,controller:["$scope",function(A){A.confirm=function(){l.enableSysUser({userId:z,activated:y}).then(function(B){if(B.statusCode==="0000"){A.loadAll()}});A.closeThisDialog()}}]})}}})();