(function(a,b){if(typeof define==="function"&&define.amd){define(["angular"],b)}else{if(a.hasOwnProperty("angular")){b(a.angular)}else{if(typeof exports==="object"){module.exports=b(require("angular"))}}}}(this,function(a){a=(a&&a.module)?a:window.angular;return a.module("ngStorage",[]).provider("$localStorage",b("localStorage")).provider("$sessionStorage",b("sessionStorage"));function b(c){return function(){var d="ngStorage-";this.setKeyPrefix=function(g){if(typeof g!=="string"){throw new TypeError("[ngStorage] - "+c+"Provider.setKeyPrefix() expects a String.")}d=g};var e=a.toJson;var f=a.fromJson;this.setSerializer=function(g){if(typeof g!=="function"){throw new TypeError("[ngStorage] - "+c+"Provider.setSerializer expects a function.")}e=g};this.setDeserializer=function(g){if(typeof g!=="function"){throw new TypeError("[ngStorage] - "+c+"Provider.setDeserializer expects a function.")}f=g};this.get=function(g){return f(window[c].getItem(d+g))};this.set=function(g,h){return window[c].setItem(d+g,e(h))};this.$get=["$rootScope","$window","$log","$timeout","$document",function(n,i,p,j,k){function q(u){var r;try{r=i[u]}catch(t){r=false}if(r&&u==="localStorage"){var s="__"+Math.round(Math.random()*10000000);try{localStorage.setItem(s,s);localStorage.removeItem(s)}catch(t){r=false}}return r}var l=d.length;var h=q(c)||(p.warn("This browser does not support Web Storage!"),{setItem:a.noop,getItem:a.noop,removeItem:a.noop}),g={$default:function(s){for(var r in s){a.isDefined(g[r])||(g[r]=a.copy(s[r]))}g.$sync();return g},$reset:function(s){for(var r in g){"$"===r[0]||(delete g[r]&&h.removeItem(d+r))}return g.$default(s)},$sync:function(){for(var t=0,r=h.length,s;t<r;t++){(s=h.key(t))&&d===s.slice(0,l)&&(g[s.slice(l)]=f(h.getItem(s)))}},$apply:function(){var s;o=null;if(!a.equals(g,m)){s=a.copy(m);a.forEach(g,function(u,t){if(a.isDefined(u)&&"$"!==t[0]){h.setItem(d+t,e(u));delete s[t]}});for(var r in s){h.removeItem(d+r)}m=a.copy(g)}}},m,o;g.$sync();m=a.copy(g);n.$watch(function(){o||(o=j(g.$apply,100,false))});i.addEventListener&&i.addEventListener("storage",function(r){if(!r.key){return}var s=k[0];if((!s.hasFocus||!s.hasFocus())&&d===r.key.slice(0,l)){r.newValue?g[r.key.slice(l)]=f(r.newValue):delete g[r.key.slice(l)];m=a.copy(g);n.$apply()}});i.addEventListener&&i.addEventListener("beforeunload",function(){g.$apply()});return g}]}}}));