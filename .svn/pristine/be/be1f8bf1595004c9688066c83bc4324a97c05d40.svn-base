(function(){angular.module("devplatformApp").controller("RoleUserController",a);a.$inject=["$uibModalInstance","Principal","RoleUserService","ParseLinks","AlertService","$state","paginationConstants","JhiLanguageService","$scope","$stateParams","$timeout","ngDialog"];function a(n,x,l,i,p,t,o,d,m,v,w,h){m.authorities=["ROLE_USER","ROLE_ADMIN"];m.currentAccount=null;m.languages=null;m.getAllUsers=g;m.page=1;m.totalItems=null;m.clear=j;m.links=null;m.loadPage=e;m.predicate="id";m.reverse="asc";m.itemsPerPage=o.itemsPerPage;m.transition=s;m.selectAll=q;m.selectOne=f;m.save=r;m.select_all=false;m.userDTOs=[];m.checked=[];m.addSysUsersId=[];m.delSysUsersId=[];m.formParam={userName:"",roleId:""};m.getAllUsers();d.getAll().then(function(y){m.languages=y});x.identity().then(function(y){m.currentAccount=y});function g(){l.getAllUsers({page_number:v.page,page_size:m.itemsPerPage,formParams:{userName:m.formParam.userName,roleId:v.sysRoleId},sort:u()}).then(b,c)}function b(y){if(y.statusCode==="0000"){var z=y.data;m.userDTOs=z.list;m.links=i.parse(z.link);m.totalItems=z.total_count;m.queryCount=m.totalItems;m.select_all=false;k()}}function c(y){p.error(y.data.message)}function j(){m.formParam={userName:""}}function u(){var y=[m.predicate+","+(m.reverse?"asc":"desc")];if(m.predicate!=="id"){y.push("id")}return y}function e(y){m.page=y;m.transition()}function s(){l.getAllUsers({page_number:m.page,page_size:m.itemsPerPage,formParams:{userName:m.formParam.userName,roleId:v.sysRoleId},sort:u()}).then(b,c)}function q(){if(m.select_all){m.checked=[];angular.forEach(m.userDTOs,function(y){y.checked=true;m.checked.push(y.id)})}else{angular.forEach(m.userDTOs,function(y){y.checked=false;m.checked=[]})}angular.forEach(m.userDTOs,function(z){var A=m.addSysUsersId.indexOf(z.id);if(z.checked&&A===-1&&!z.sysUsersId){m.addSysUsersId.push(z.id)}else{if(!z.checked&&A!==-1){m.addSysUsersId.splice(index,1)}}var y=m.delSysUsersId.indexOf(z.id);if(!z.checked&&y===-1&&z.sysUsersId){m.delSysUsersId.push(z.id)}else{if(z.checked&&y!==-1){m.delSysUsersId.splice(index,1)}}})}function f(){angular.forEach(m.userDTOs,function(A){var z=m.checked.indexOf(A.id);if(A.checked&&z===-1){m.checked.push(A.id)}else{if(!A.checked&&z!==-1){m.checked.splice(z,1)}}var B=m.addSysUsersId.indexOf(A.id);if(A.checked&&B===-1&&!A.sysUsersId){m.addSysUsersId.push(A.id)}else{if(!A.checked&&B!==-1){m.addSysUsersId.splice(B,1)}}var y=m.delSysUsersId.indexOf(A.id);if(!A.checked&&y===-1&&A.sysUsersId){m.delSysUsersId.push(A.id)}else{if(A.checked&&y!==-1){m.delSysUsersId.splice(y,1)}}});if(m.userDTOs.length===m.checked.length){m.select_all=true}else{m.select_all=false}}function k(){angular.forEach(m.userDTOs,function(A){if(A.sysUsersId){A.checked=true}var B=m.delSysUsersId.indexOf(A.id);if(B!==-1){A.checked=false}var z=m.addSysUsersId.indexOf(A.id);if(z!==-1){A.checked=true}var y=0;angular.forEach(m.userDTOs,function(C){if(C.checked){y++}});if(m.userDTOs.length===y){m.select_all=true}})}function r(){l.saveSysUserRole({sysRolesId:v.sysRoleId,addSysUsersId:m.addSysUsersId,delSysUsersId:m.delSysUsersId}).then(function(y){if(y.statusCode==="0000"){var z=y.msgCode;m.openDialog(z);n.dismiss("cancel");t.go("app.role-manager")}else{var z=y.msgCode;m.openDialog(z)}});m.isSaving=false}m.openDialog=function(y){h.openConfirm({template:"app/common/dialog.html",className:"ngdialog-theme-default",controller:["$scope",function(z){z.message=y}]})};m.cancelDialog=function(){n.dismiss("cancel");t.go("app.role-manager")}}})();